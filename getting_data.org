# -**- eval: org-toggle-inline-images: 1 -**-
#+Title: Getting Eurostat data on health and mortality
#+Author: Jan Boone@@latex:\thanks{Tilburg University, Department of Economics, Tilec and CEPR, E-mail: \textit{j.boone@uvt.nl}.}@@
#+PROPERTY: header-args  :session geopandas :kernel python3 :async yes
# kernel can be geo_env or python3

#+LANGUAGE: en
#+INFOJS_OPT: toc:1 ltoc:1 mouse:underline path:http://orgmode.org/org-info.js
#+LaTeX_CLASS: article-12
#+EXPORT_SELECT_TAGS: export
#+EXPORT_EXCLUDE_TAGS: noexport
#+OPTIONS: toc:nil timestamp:nil \n:nil @:t ::t |:t ^:{} _:{} *:t TeX:t LaTeX:t
#+HTML_HEAD: <link rel="stylesheet" href="./latex-css/style.css">
#+HTML_HEAD: <link rel="stylesheet" href="https://latex.now.sh/prism/prism.css">
#+HTML_HEAD: <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>


# this file must exist be a path or exist in `org-cite-csl-styles-dir': # apa-5th-edition.csl
#+csl-style: chicago-author-date-16th-edition.csl

# this must be a locales file in `org-cite-csl-locales-dir'. Defaults to en-US
#+csl-locale: en-US

* code to export to html :noexport:

#+BEGIN_SRC emacs-lisp :results silent
(setq org-export-with-broken-links t)

(require 'org-ref-refproc)
(let ((org-export-before-parsing-hook '(;;org-ref-cite-natmove ;; do this first
                    org-ref-csl-preprocess-buffer
                    org-ref-refproc)))
  (org-open-file (org-html-export-to-html)))
#+END_SRC

* Introduction

This file describes how we get the data for our project on [[./index.org][the health effects of demand side cost sharing]].

In this file we explain how we get the data and from where and at the same time we generate the data. By generating the data in this way, a change in the data by Eurostat will lead to (slightly) different results.

- Overview of data available at the region level: https://ec.europa.eu/eurostat/web/regions/background
- Link to excel file with overview: http://ec.europa.eu/eurostat/documents/140934/4381644/Regional-statistics-overview.xlsx


The dataset itself is too big for github and can be found on [[https://dataverse.nl/dataset.xhtml?persistentId=doi:10.34894/AABEBD][DataverseNL]].


* Preamble code

Run this code first before running the code of particular data sets. It imports the relevant libraries.

#+begin_src jupyter-python
import numpy as np
import pandas as pd
from country_codes import oecd_dictionary, eurostat_dictionary
import eurostat
import xarray as xr
import matplotlib.pyplot as plt

EU_countries = ['Belgium', 'Bulgaria', 'Czechia', 'Denmark',
'Germany (until 1990 former territory of the FRG)', 'Germany','Estonia',
'Ireland', 'Greece', 'Spain', 'France', 'Croatia', 'Italy',
'Cyprus', 'Latvia', 'Lithuania', 'Luxembourg', 'Hungary', 'Malta',
'Netherlands', 'Austria', 'Poland', 'Portugal', 'Romania',
'Slovenia', 'Slovakia', 'Finland', 'Sweden', 'United Kingdom',
'Iceland', 'Liechtenstein', 'Norway', 'Switzerland',
'Bosnia and Herzegovina']

#+end_src

#+RESULTS:


We first describe how we get the data for each variable. Each of these variables is saved in a separate dataset. The final section contains the code that merges the data for these variables into one (big) dataset.

* Data

First, we fetch the variables at the country level from the Eurostat website. Then we move to the NUTS 2 regional data.

** country data

*** OOP per country

We want a measure of "how generous" a healthcare system is in terms of oop-payments. This feature of the healthcare system tends to be defined at the country level. We use household oop payment and expenditure on voluntary payment schemes (for things that are not covered by basic or mandatory insurance). The paper uses mainly =PC_CHE= as unit of measurement.

- link to data: https://ec.europa.eu/eurostat/databrowser/view/hlth_sha11_hf/default/table?lang=en

| abbreviation | name                                                       |
|--------------+------------------------------------------------------------|
| HF2          | Voluntary health care payment schemes                      |
| HF3          | Household out-of-pocket payment                            |
| PC_CHE       | Percentual share of total current health expenditure (CHE) |
| PPS_HAB      | Purchasing power standard (PPS) per inhabitant             |


#+begin_src jupyter-python 
df = eurostat.get_data_df('hlth_sha11_hf')
df.rename({'geo\\time':'geo'},inplace=True,axis=1)
df['country_code'] = [x[:2] for x in df['geo']]
df['country'] = df['country_code'].replace(eurostat_dictionary)
df = df[df.country.isin(EU_countries)  & \
        (df.icha11_hf.isin(["HF2", "HF3"])) &\
        (df.unit.isin([ 'PC_CHE','PPS_HAB']))]
df.drop(["geo"],axis=1,inplace=True)

df = pd.melt(df,id_vars=['country','country_code',\
                         'unit','icha11_hf'],
                        value_vars=np.arange(1992,2019),
                        var_name='year',\
             value_name='health_expenditure')
df.set_index(['country','country_code',\
              'year','unit','icha11_hf'],inplace=True)
df = df.unstack()
df.columns = df.columns.droplevel()
df = df.unstack()
df.columns = df.columns.droplevel()
df.columns = ['HF2_PC_CHE','HF2_PPS_HAB',\
              'HF3_PC_CHE','HF3_PPS_HAB']
df.reset_index(inplace=True)
df.set_index(['country','country_code','year'],inplace=True)
df.tail()
#+end_src

#+RESULTS:
#+begin_export html
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>HF2_PC_CHE</th>
      <th>HF2_PPS_HAB</th>
      <th>HF3_PC_CHE</th>
      <th>HF3_PPS_HAB</th>
    </tr>
    <tr>
      <th>country</th>
      <th>country_code</th>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">United Kingdom</th>
      <th rowspan="5" valign="top">UK</th>
      <th>2014</th>
      <td>5.40</td>
      <td>155.48</td>
      <td>15.16</td>
      <td>436.73</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>5.40</td>
      <td>161.07</td>
      <td>15.23</td>
      <td>454.78</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>5.04</td>
      <td>148.46</td>
      <td>15.37</td>
      <td>453.16</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>5.41</td>
      <td>160.78</td>
      <td>15.72</td>
      <td>467.53</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>5.62</td>
      <td>172.06</td>
      <td>15.88</td>
      <td>486.25</td>
    </tr>
  </tbody>
</table>
</div>
#+end_export

#+begin_src jupyter-python 
ds = df.to_xarray()
ds.to_netcdf("./data/country/out_of_pocket.nc")
ds
#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:       (country: 33, country_code: 33, year: 27)
Coordinates:
  * country       (country) object &#x27;Austria&#x27; &#x27;Belgium&#x27; ... &#x27;United Kingdom&#x27;
  * country_code  (country_code) object &#x27;AT&#x27; &#x27;BA&#x27; &#x27;BE&#x27; &#x27;BG&#x27; ... &#x27;SI&#x27; &#x27;SK&#x27; &#x27;UK&#x27;
  * year          (year) int64 1992 1993 1994 1995 1996 ... 2015 2016 2017 2018
Data variables:
    HF2_PC_CHE    (country, country_code, year) float64 nan nan ... 5.41 5.62
    HF2_PPS_HAB   (country, country_code, year) float64 nan nan ... 160.8 172.1
    HF3_PC_CHE    (country, country_code, year) float64 nan nan ... 15.72 15.88
    HF3_PPS_HAB   (country, country_code, year) float64 nan nan ... 467.5 486.2</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-a1773be3-e7d7-402f-9b7b-f128636d0744' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-a1773be3-e7d7-402f-9b7b-f128636d0744' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>country</span>: 33</li><li><span class='xr-has-index'>country_code</span>: 33</li><li><span class='xr-has-index'>year</span>: 27</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-8937829c-0909-469f-a31c-6a0201fd156b' class='xr-section-summary-in' type='checkbox'  checked><label for='section-8937829c-0909-469f-a31c-6a0201fd156b' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>country</span></div><div class='xr-var-dims'>(country)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;Austria&#x27; ... &#x27;United Kingdom&#x27;</div><input id='attrs-64ab4fbd-258d-4540-8963-2f3455ee8b14' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-64ab4fbd-258d-4540-8963-2f3455ee8b14' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-cd4ada82-a5a4-451e-8121-ecfb1dd4a5c2' class='xr-var-data-in' type='checkbox'><label for='data-cd4ada82-a5a4-451e-8121-ecfb1dd4a5c2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Austria&#x27;, &#x27;Belgium&#x27;, &#x27;Bosnia and Herzegovina&#x27;, &#x27;Bulgaria&#x27;, &#x27;Croatia&#x27;,
       &#x27;Cyprus&#x27;, &#x27;Czechia&#x27;, &#x27;Denmark&#x27;, &#x27;Estonia&#x27;, &#x27;Finland&#x27;, &#x27;France&#x27;,
       &#x27;Germany&#x27;, &#x27;Greece&#x27;, &#x27;Hungary&#x27;, &#x27;Iceland&#x27;, &#x27;Ireland&#x27;, &#x27;Italy&#x27;, &#x27;Latvia&#x27;,
       &#x27;Liechtenstein&#x27;, &#x27;Lithuania&#x27;, &#x27;Luxembourg&#x27;, &#x27;Malta&#x27;, &#x27;Netherlands&#x27;,
       &#x27;Norway&#x27;, &#x27;Poland&#x27;, &#x27;Portugal&#x27;, &#x27;Romania&#x27;, &#x27;Slovakia&#x27;, &#x27;Slovenia&#x27;,
       &#x27;Spain&#x27;, &#x27;Sweden&#x27;, &#x27;Switzerland&#x27;, &#x27;United Kingdom&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>country_code</span></div><div class='xr-var-dims'>(country_code)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;AT&#x27; &#x27;BA&#x27; &#x27;BE&#x27; ... &#x27;SI&#x27; &#x27;SK&#x27; &#x27;UK&#x27;</div><input id='attrs-ade9e423-15ea-47e8-89eb-be74710a1505' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ade9e423-15ea-47e8-89eb-be74710a1505' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-007d0bb4-6d8b-43b7-ac8b-fc901d98f32e' class='xr-var-data-in' type='checkbox'><label for='data-007d0bb4-6d8b-43b7-ac8b-fc901d98f32e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AT&#x27;, &#x27;BA&#x27;, &#x27;BE&#x27;, &#x27;BG&#x27;, &#x27;CH&#x27;, &#x27;CY&#x27;, &#x27;CZ&#x27;, &#x27;DE&#x27;, &#x27;DK&#x27;, &#x27;EE&#x27;, &#x27;EL&#x27;, &#x27;ES&#x27;,
       &#x27;FI&#x27;, &#x27;FR&#x27;, &#x27;HR&#x27;, &#x27;HU&#x27;, &#x27;IE&#x27;, &#x27;IS&#x27;, &#x27;IT&#x27;, &#x27;LI&#x27;, &#x27;LT&#x27;, &#x27;LU&#x27;, &#x27;LV&#x27;, &#x27;MT&#x27;,
       &#x27;NL&#x27;, &#x27;NO&#x27;, &#x27;PL&#x27;, &#x27;PT&#x27;, &#x27;RO&#x27;, &#x27;SE&#x27;, &#x27;SI&#x27;, &#x27;SK&#x27;, &#x27;UK&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1992 1993 1994 ... 2016 2017 2018</div><input id='attrs-3fbf1bf1-fea8-4879-bbb9-0f92e8df833e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3fbf1bf1-fea8-4879-bbb9-0f92e8df833e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-027e7e08-fdd3-4428-946c-ccb3537a55dc' class='xr-var-data-in' type='checkbox'><label for='data-027e7e08-fdd3-4428-946c-ccb3537a55dc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003,
       2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015,
       2016, 2017, 2018])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-2ba6cf8a-f946-40ae-bf49-b2621bca959f' class='xr-section-summary-in' type='checkbox'  checked><label for='section-2ba6cf8a-f946-40ae-bf49-b2621bca959f' class='xr-section-summary' >Data variables: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>HF2_PC_CHE</span></div><div class='xr-var-dims'>(country, country_code, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... 5.04 5.41 5.62</div><input id='attrs-5a769f96-4593-4156-ae1e-0422d702aa53' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-5a769f96-4593-4156-ae1e-0422d702aa53' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-702cb3d3-5429-400a-8fb8-1d2665b447b0' class='xr-var-data-in' type='checkbox'><label for='data-702cb3d3-5429-400a-8fb8-1d2665b447b0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[ nan,  nan,  nan, ..., 6.8 , 6.83, 6.91],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        ...,
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

       [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ..., 4.74, 4.86, 4.9 ],
        ...,
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

       [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ..., 0.3 , 0.37, 0.4 ],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        ...,
...
        ...,
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

       [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        ...,
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

       [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        ...,
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ..., 5.04, 5.41, 5.62]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>HF2_PPS_HAB</span></div><div class='xr-var-dims'>(country, country_code, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan ... 148.5 160.8 172.1</div><input id='attrs-2fc19ad2-20b1-4d8f-bd42-6784b1350345' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2fc19ad2-20b1-4d8f-bd42-6784b1350345' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e0cf0036-0f57-46e1-9137-3991c486a2cb' class='xr-var-data-in' type='checkbox'><label for='data-e0cf0036-0f57-46e1-9137-3991c486a2cb' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[   nan,    nan,    nan, ..., 260.74, 263.61, 274.53],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ..., 175.08, 180.84, 187.76],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,   2.54,   3.08,   3.48],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
...
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ..., 148.46, 160.78, 172.06]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>HF3_PC_CHE</span></div><div class='xr-var-dims'>(country, country_code, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan ... 15.37 15.72 15.88</div><input id='attrs-44d6aa07-bcac-4712-85c4-8eca7e3505ef' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-44d6aa07-bcac-4712-85c4-8eca7e3505ef' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9a519034-c7c5-494f-a411-156ac04a5074' class='xr-var-data-in' type='checkbox'><label for='data-9a519034-c7c5-494f-a411-156ac04a5074' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[  nan,   nan,   nan, ..., 19.24, 19.15, 18.43],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ..., 18.09, 17.91, 17.81],
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ..., 28.61, 29.12, 29.31],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        ...,
...
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ..., 15.37, 15.72, 15.88]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>HF3_PPS_HAB</span></div><div class='xr-var-dims'>(country, country_code, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan ... 453.2 467.5 486.2</div><input id='attrs-f8f4d140-1f23-4d63-88cd-6785233e17c2' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f8f4d140-1f23-4d63-88cd-6785233e17c2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a788bc64-3750-48c1-8c42-0db5b25cbae8' class='xr-var-data-in' type='checkbox'><label for='data-a788bc64-3750-48c1-8c42-0db5b25cbae8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[   nan,    nan,    nan, ..., 738.36, 739.37, 732.45],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ..., 667.95, 665.96, 682.09],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ..., 242.78, 242.47, 256.89],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
...
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ..., 453.16, 467.53, 486.25]]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-d335e1ad-a721-45ce-97d4-f72b5fae4c77' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-d335e1ad-a721-45ce-97d4-f72b5fae4c77' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export




*** healthcare expenditure

- link to data: https://ec.europa.eu/eurostat/databrowser/view/hlth_sha11_hc/default/table?lang=en

| abbreviation | variable name                         |
|--------------+---------------------------------------|
| TOT_HC       | Current health care expenditure (CHE) |
| EUR_HAB      | Euro per inhabitant                   |


#+begin_src jupyter-python 
df = eurostat.get_data_df('hlth_sha11_hc')
df.rename({'geo\\time':'geo'},inplace=True,axis=1)
df['country_code'] = [x[:2] for x in df['geo']]
df['country'] = df['country_code'].replace(eurostat_dictionary)
df = df[df.country.isin(EU_countries)  & \
        (df.icha11_hc.isin(["TOT_HC"])) & \
        (df.unit.isin(['EUR_HAB']))]
df.drop(["geo"],axis=1,inplace=True)

df = pd.melt(df,id_vars=['country','country_code',\
                         'unit','icha11_hc'],
                        value_vars=np.arange(1992,2020),
                        var_name='year',\
             value_name='health_expenditure')
df.set_index(['country','country_code','year',\
              'unit','icha11_hc'],inplace=True)
df = df.unstack()
df.columns = df.columns.droplevel()
df = df.unstack()
df.columns = df.columns.droplevel()
df.reset_index(inplace=True)
df.rename({'EUR_HAB':'health expenditure per capita'},\
          axis=1,inplace=True)
df.set_index(['country','country_code','year'],inplace=True)
df.head()
#+end_src

#+RESULTS:
#+begin_export html
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>unit</th>
      <th>health expenditure per capita</th>
    </tr>
    <tr>
      <th>country</th>
      <th>country_code</th>
      <th>year</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">Austria</th>
      <th rowspan="5" valign="top">AT</th>
      <th>1992</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1993</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1994</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1995</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1996</th>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
#+end_export


#+begin_src jupyter-python 
ds = df.to_xarray()
ds.to_netcdf("./data/country/healthcare_expenditure.nc")
ds
#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:                        (country: 33, country_code: 33, year: 28)
Coordinates:
  * country                        (country) object &#x27;Austria&#x27; ... &#x27;United Kin...
  * country_code                   (country_code) object &#x27;AT&#x27; &#x27;BA&#x27; ... &#x27;SK&#x27; &#x27;UK&#x27;
  * year                           (year) int64 1992 1993 1994 ... 2018 2019
Data variables:
    health expenditure per capita  (country, country_code, year) float64 nan ...</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-f762ce49-e360-47d5-9198-005c31ea827a' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-f762ce49-e360-47d5-9198-005c31ea827a' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>country</span>: 33</li><li><span class='xr-has-index'>country_code</span>: 33</li><li><span class='xr-has-index'>year</span>: 28</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-6b154b26-6e24-429c-9107-cfbef95875db' class='xr-section-summary-in' type='checkbox'  checked><label for='section-6b154b26-6e24-429c-9107-cfbef95875db' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>country</span></div><div class='xr-var-dims'>(country)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;Austria&#x27; ... &#x27;United Kingdom&#x27;</div><input id='attrs-d5baec19-0e7c-4a37-933c-669fe8644950' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d5baec19-0e7c-4a37-933c-669fe8644950' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8db18c77-4fe9-4f7d-b99e-9454383b835c' class='xr-var-data-in' type='checkbox'><label for='data-8db18c77-4fe9-4f7d-b99e-9454383b835c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Austria&#x27;, &#x27;Belgium&#x27;, &#x27;Bosnia and Herzegovina&#x27;, &#x27;Bulgaria&#x27;, &#x27;Croatia&#x27;,
       &#x27;Cyprus&#x27;, &#x27;Czechia&#x27;, &#x27;Denmark&#x27;, &#x27;Estonia&#x27;, &#x27;Finland&#x27;, &#x27;France&#x27;,
       &#x27;Germany&#x27;, &#x27;Greece&#x27;, &#x27;Hungary&#x27;, &#x27;Iceland&#x27;, &#x27;Ireland&#x27;, &#x27;Italy&#x27;, &#x27;Latvia&#x27;,
       &#x27;Liechtenstein&#x27;, &#x27;Lithuania&#x27;, &#x27;Luxembourg&#x27;, &#x27;Malta&#x27;, &#x27;Netherlands&#x27;,
       &#x27;Norway&#x27;, &#x27;Poland&#x27;, &#x27;Portugal&#x27;, &#x27;Romania&#x27;, &#x27;Slovakia&#x27;, &#x27;Slovenia&#x27;,
       &#x27;Spain&#x27;, &#x27;Sweden&#x27;, &#x27;Switzerland&#x27;, &#x27;United Kingdom&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>country_code</span></div><div class='xr-var-dims'>(country_code)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;AT&#x27; &#x27;BA&#x27; &#x27;BE&#x27; ... &#x27;SI&#x27; &#x27;SK&#x27; &#x27;UK&#x27;</div><input id='attrs-accd4c84-6b46-4065-874d-fd94cdcf6ff8' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-accd4c84-6b46-4065-874d-fd94cdcf6ff8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-483e27d1-3789-4d0b-bcba-32d87857dc11' class='xr-var-data-in' type='checkbox'><label for='data-483e27d1-3789-4d0b-bcba-32d87857dc11' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AT&#x27;, &#x27;BA&#x27;, &#x27;BE&#x27;, &#x27;BG&#x27;, &#x27;CH&#x27;, &#x27;CY&#x27;, &#x27;CZ&#x27;, &#x27;DE&#x27;, &#x27;DK&#x27;, &#x27;EE&#x27;, &#x27;EL&#x27;, &#x27;ES&#x27;,
       &#x27;FI&#x27;, &#x27;FR&#x27;, &#x27;HR&#x27;, &#x27;HU&#x27;, &#x27;IE&#x27;, &#x27;IS&#x27;, &#x27;IT&#x27;, &#x27;LI&#x27;, &#x27;LT&#x27;, &#x27;LU&#x27;, &#x27;LV&#x27;, &#x27;MT&#x27;,
       &#x27;NL&#x27;, &#x27;NO&#x27;, &#x27;PL&#x27;, &#x27;PT&#x27;, &#x27;RO&#x27;, &#x27;SE&#x27;, &#x27;SI&#x27;, &#x27;SK&#x27;, &#x27;UK&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1992 1993 1994 ... 2017 2018 2019</div><input id='attrs-2ce24650-c2c4-413d-afca-7ba3256b32dc' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2ce24650-c2c4-413d-afca-7ba3256b32dc' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2fd467e7-8076-47ed-a7a6-99836cce6f60' class='xr-var-data-in' type='checkbox'><label for='data-2fd467e7-8076-47ed-a7a6-99836cce6f60' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003,
       2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015,
       2016, 2017, 2018, 2019])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-e89ce06a-3603-40f9-b49e-d3f5ff7b0bf8' class='xr-section-summary-in' type='checkbox'  checked><label for='section-e89ce06a-3603-40f9-b49e-d3f5ff7b0bf8' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>health expenditure per capita</span></div><div class='xr-var-dims'>(country, country_code, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan ... 3.608e+03 3.839e+03</div><input id='attrs-46001961-5386-41e5-9264-8341edccec9e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-46001961-5386-41e5-9264-8341edccec9e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-38c5420d-17d3-4c7e-bc3d-af9408ddc3c7' class='xr-var-data-in' type='checkbox'><label for='data-38c5420d-17d3-4c7e-bc3d-af9408ddc3c7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[    nan,     nan,     nan, ..., 4359.69, 4510.08, 4689.27],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        ...,
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan]],

       [[    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ..., 4206.56, 4343.57, 4438.82],
        ...,
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan]],

       [[    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,  409.09,  434.88,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        ...,
...
        ...,
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan]],

       [[    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        ...,
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan]],

       [[    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        ...,
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ..., 3503.62, 3607.59, 3838.53]]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-5dccd30c-e23e-4d31-9518-fd7d6bb09312' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-5dccd30c-e23e-4d31-9518-fd7d6bb09312' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export



*** treatable and preventable mortality
- https://ec.europa.eu/eurostat/databrowser/view/hlth_cd_apr/default/map?lang=en

#+begin_src jupyter-python :display plain
df = eurostat.get_data_df('hlth_cd_apr')
df.rename({'geo\\time':'geo'},inplace=True,axis=1)
df['country'] = df['geo'].replace(eurostat_dictionary)
df = df[df.country.isin(EU_countries) & (df.sex.isin(["M","F"]) ) & (df.mortalit.isin(["PRVT","TRT"])) & (df.unit == "RT") & (df.icd10 == "TOTAL")]
df.drop(["unit","icd10","geo"],axis=1,inplace=True)
df = pd.melt(df,id_vars=['country','sex','mortalit'],
                        value_vars=np.arange(2011,2021),
                        var_name='year',value_name='rate')
df.set_index(['country','year','sex','mortalit'],inplace=True)
df = df.unstack()
df.reset_index(inplace=True)
df.columns = [' '.join(col).strip() for col in df.columns.values]
df.rename({'rate PRVT':'Preventable mortality', 'rate TRT':'Treatable mortality'},inplace=True,axis=1)
# df.to_csv('./data/preventable_mortality.csv')
df.reset_index(inplace=True)
df.set_index(['country','year','sex'],inplace=True)
df.head()
#+end_src

#+RESULTS:
:                   index  Preventable mortality  Treatable mortality
: country year sex                                                   
: Austria 2011 F        0                  95.29                67.41
:              M        1                 248.50                96.86
:         2012 F        2                  96.16                69.72
:              M        3                 252.28                91.45
:         2013 F        4                  93.22                66.84


#+begin_src jupyter-python 
ds = df.to_xarray()
ds.to_netcdf("./data/country/preventable_treatable.nc")
ds
#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:                (country: 32, sex: 2, year: 10)
Coordinates:
  * country                (country) object &#x27;Austria&#x27; ... &#x27;United Kingdom&#x27;
  * year                   (year) int64 2011 2012 2013 2014 ... 2018 2019 2020
  * sex                    (sex) object &#x27;F&#x27; &#x27;M&#x27;
Data variables:
    index                  (country, year, sex) int64 0 1 2 3 ... 637 638 639
    Preventable mortality  (country, year, sex) float64 95.29 248.5 ... nan nan
    Treatable mortality    (country, year, sex) float64 67.41 96.86 ... nan nan</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-da6c7bd6-00be-4846-b610-4ca840721a20' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-da6c7bd6-00be-4846-b610-4ca840721a20' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>country</span>: 32</li><li><span class='xr-has-index'>sex</span>: 2</li><li><span class='xr-has-index'>year</span>: 10</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-fb958d97-eaac-4fc9-9f31-b3a538cbd28e' class='xr-section-summary-in' type='checkbox'  checked><label for='section-fb958d97-eaac-4fc9-9f31-b3a538cbd28e' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>country</span></div><div class='xr-var-dims'>(country)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;Austria&#x27; ... &#x27;United Kingdom&#x27;</div><input id='attrs-8aa4872d-2a4f-4959-bb5a-5cbb574967d0' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-8aa4872d-2a4f-4959-bb5a-5cbb574967d0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1e3c169b-eef2-483d-a02b-11114db053b1' class='xr-var-data-in' type='checkbox'><label for='data-1e3c169b-eef2-483d-a02b-11114db053b1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Austria&#x27;, &#x27;Belgium&#x27;, &#x27;Bulgaria&#x27;, &#x27;Croatia&#x27;, &#x27;Cyprus&#x27;, &#x27;Czechia&#x27;,
       &#x27;Denmark&#x27;, &#x27;Estonia&#x27;, &#x27;Finland&#x27;, &#x27;France&#x27;, &#x27;Germany&#x27;, &#x27;Greece&#x27;,
       &#x27;Hungary&#x27;, &#x27;Iceland&#x27;, &#x27;Ireland&#x27;, &#x27;Italy&#x27;, &#x27;Latvia&#x27;, &#x27;Liechtenstein&#x27;,
       &#x27;Lithuania&#x27;, &#x27;Luxembourg&#x27;, &#x27;Malta&#x27;, &#x27;Netherlands&#x27;, &#x27;Norway&#x27;, &#x27;Poland&#x27;,
       &#x27;Portugal&#x27;, &#x27;Romania&#x27;, &#x27;Slovakia&#x27;, &#x27;Slovenia&#x27;, &#x27;Spain&#x27;, &#x27;Sweden&#x27;,
       &#x27;Switzerland&#x27;, &#x27;United Kingdom&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>2011 2012 2013 ... 2018 2019 2020</div><input id='attrs-3bdae2f5-2522-4f76-af68-b89419366688' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3bdae2f5-2522-4f76-af68-b89419366688' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f7fcb969-9c7c-4681-9f2c-bb458db6f63e' class='xr-var-data-in' type='checkbox'><label for='data-f7fcb969-9c7c-4681-9f2c-bb458db6f63e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>sex</span></div><div class='xr-var-dims'>(sex)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;F&#x27; &#x27;M&#x27;</div><input id='attrs-96539452-f54f-492a-9eaf-b47000d1b7d1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-96539452-f54f-492a-9eaf-b47000d1b7d1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f92b2bac-62ab-4641-be2d-acb8b37b2dbc' class='xr-var-data-in' type='checkbox'><label for='data-f92b2bac-62ab-4641-be2d-acb8b37b2dbc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;F&#x27;, &#x27;M&#x27;], dtype=object)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-477b6c9c-9e69-44c3-a09d-38ce8bd4ef60' class='xr-section-summary-in' type='checkbox'  checked><label for='section-477b6c9c-9e69-44c3-a09d-38ce8bd4ef60' class='xr-section-summary' >Data variables: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>index</span></div><div class='xr-var-dims'>(country, year, sex)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 ... 635 636 637 638 639</div><input id='attrs-d8436261-4a92-48bc-86bc-e23fa1c94dba' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d8436261-4a92-48bc-86bc-e23fa1c94dba' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ff061033-9da1-484c-b2d6-f9d661ee28f8' class='xr-var-data-in' type='checkbox'><label for='data-ff061033-9da1-484c-b2d6-f9d661ee28f8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[  0,   1],
        [  2,   3],
        [  4,   5],
        [  6,   7],
        [  8,   9],
        [ 10,  11],
        [ 12,  13],
        [ 14,  15],
        [ 16,  17],
        [ 18,  19]],

       [[ 20,  21],
        [ 22,  23],
        [ 24,  25],
        [ 26,  27],
        [ 28,  29],
        [ 30,  31],
        [ 32,  33],
        [ 34,  35],
        [ 36,  37],
...
        [602, 603],
        [604, 605],
        [606, 607],
        [608, 609],
        [610, 611],
        [612, 613],
        [614, 615],
        [616, 617],
        [618, 619]],

       [[620, 621],
        [622, 623],
        [624, 625],
        [626, 627],
        [628, 629],
        [630, 631],
        [632, 633],
        [634, 635],
        [636, 637],
        [638, 639]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>Preventable mortality</span></div><div class='xr-var-dims'>(country, year, sex)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>95.29 248.5 96.16 ... nan nan nan</div><input id='attrs-c63f0454-b395-4256-a1d9-cc6cd973a8ab' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c63f0454-b395-4256-a1d9-cc6cd973a8ab' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1f65bebe-32a1-4a99-a4d0-6132685a0298' class='xr-var-data-in' type='checkbox'><label for='data-1f65bebe-32a1-4a99-a4d0-6132685a0298' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[ 95.29, 248.5 ],
        [ 96.16, 252.28],
        [ 93.22, 245.9 ],
        [ 93.95, 238.63],
        [ 97.52, 242.3 ],
        [ 96.39, 231.4 ],
        [ 92.94, 226.73],
        [ 93.11, 226.09],
        [ 94.79, 213.51],
        [ 99.09, 236.22]],

       [[101.35, 248.21],
        [ 99.97, 246.27],
        [100.34, 239.34],
        [ 95.4 , 231.42],
        [ 99.71, 225.13],
        [ 94.13, 218.89],
        [ 93.42, 208.83],
        [ 92.63, 202.27],
        [ 92.07, 194.96],
...
        [ 74.02, 173.75],
        [ 73.85, 171.67],
        [ 72.7 , 160.99],
        [ 69.37, 165.95],
        [ 68.91, 155.29],
        [ 68.45, 152.01],
        [ 70.94, 147.78],
        [ 66.9 , 142.11],
        [ 72.59, 161.98]],

       [[107.87, 213.43],
        [107.15, 208.24],
        [105.41, 206.69],
        [105.41, 201.67],
        [106.21, 203.1 ],
        [107.03, 203.71],
        [105.04, 201.73],
        [104.55, 198.42],
        [   nan,    nan],
        [   nan,    nan]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>Treatable mortality</span></div><div class='xr-var-dims'>(country, year, sex)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>67.41 96.86 69.72 ... nan nan nan</div><input id='attrs-b58caceb-f260-4523-abff-17bf21f36f77' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b58caceb-f260-4523-abff-17bf21f36f77' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-80622d1d-a13b-40c5-b848-57e02667a589' class='xr-var-data-in' type='checkbox'><label for='data-80622d1d-a13b-40c5-b848-57e02667a589' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[ 67.41,  96.86],
        [ 69.72,  91.45],
        [ 66.84,  92.05],
        [ 66.7 ,  90.11],
        [ 66.85,  92.66],
        [ 66.58,  90.42],
        [ 65.48,  88.27],
        [ 64.61,  87.16],
        [ 63.22,  84.21],
        [ 60.44,  81.55]],

       [[ 78.98,  86.28],
        [ 77.35,  87.46],
        [ 76.24,  87.82],
        [ 70.91,  79.38],
        [ 69.15,  79.3 ],
        [ 66.19,  77.34],
        [ 66.61,  75.81],
        [ 66.65,  73.03],
        [ 61.35,  69.09],
...
        [ 56.32,  63.45],
        [ 53.98,  61.6 ],
        [ 52.3 ,  60.65],
        [ 52.13,  59.86],
        [ 51.35,  54.23],
        [ 49.4 ,  54.71],
        [ 47.97,  54.21],
        [ 47.54,  52.02],
        [ 44.86,  52.54]],

       [[ 85.92, 103.49],
        [ 85.12, 100.37],
        [ 82.29,  98.42],
        [ 81.24,  96.08],
        [ 81.74,  97.94],
        [ 83.25,  97.55],
        [ 80.52,  96.8 ],
        [ 80.19,  95.09],
        [   nan,    nan],
        [   nan,    nan]]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-d3064768-7727-48ab-bc4f-28b0087666f7' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-d3064768-7727-48ab-bc4f-28b0087666f7' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export

*** self-perceived health

See below with mortality to merge these data on age as well.







** nuts 2


- overview of regional data: https://ec.europa.eu/eurostat/web/regions/data/database

*** crude number of deaths and population by age and sex and self-perceived health


- population: https://ec.europa.eu/eurostat/databrowser/view/demo_r_d2jan/default/table?lang=en


#+begin_src jupyter-python 
df = eurostat.get_data_df('demo_r_d2jan')
df.rename({'geo\\time':'geo'},inplace=True,axis=1)
age_range = ['Y1', 'Y10', 'Y11', 'Y12', 'Y13', 'Y14', 'Y15',
       'Y16', 'Y17', 'Y18', 'Y19', 'Y2', 'Y20', 'Y21', 'Y22', 'Y23',
       'Y24', 'Y25', 'Y26', 'Y27', 'Y28', 'Y29', 'Y3', 'Y30', 'Y31',
       'Y32', 'Y33', 'Y34', 'Y35', 'Y36', 'Y37', 'Y38', 'Y39', 'Y4',
       'Y40', 'Y41', 'Y42', 'Y43', 'Y44', 'Y45', 'Y46', 'Y47', 'Y48',
       'Y49', 'Y5', 'Y50', 'Y51', 'Y52', 'Y53', 'Y54', 'Y55', 'Y56',
       'Y57', 'Y58', 'Y59', 'Y6', 'Y60', 'Y61', 'Y62', 'Y63', 'Y64',
       'Y65', 'Y66', 'Y67', 'Y68', 'Y69', 'Y7', 'Y70', 'Y71', 'Y72',
       'Y73', 'Y74', 'Y75', 'Y76', 'Y77', 'Y78', 'Y79', 'Y8', 'Y80',
       'Y81', 'Y82', 'Y83', 'Y84', 'Y85', 'Y86', 'Y87', 'Y88', 'Y89',
       'Y9', 'Y90', 'Y91', 'Y92', 'Y93', 'Y94', 'Y95', 'Y96', 'Y97',
       'Y98', 'Y99']
df['country_code'] = [x[:2] for x in df['geo']]
df['country'] = df['country_code'].replace(eurostat_dictionary)
df = df[df.country.isin(EU_countries) & \
        (df.sex.isin(["M","F"])) & (df.age.isin(age_range))]
df.drop(['country_code'],axis=1,inplace=True)
df = pd.melt(df,id_vars=['geo','country','sex','age'],
                        value_vars=np.arange(1990,2021),
                        var_name='year',value_name='population')
df['nuts'] = [len(x)-2 for x in df.geo]
df = df.query('nuts == 2')
df.drop('nuts',inplace=True, axis=1)
df.rename({'geo':'nuts2', 'age':'age string'},\
          axis=1,inplace=True)
df['age'] = [float(x.replace('Y','')) for x in df['age string']]
df.drop('age string',inplace=True, axis=1)

#df.set_index(['nuts2','year','sex','age'],inplace=True)

df.head()
#+end_src

#+RESULTS:
#+begin_export html
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nuts2</th>
      <th>country</th>
      <th>sex</th>
      <th>year</th>
      <th>population</th>
      <th>age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>AT11</td>
      <td>Austria</td>
      <td>F</td>
      <td>1990</td>
      <td>1345.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AT12</td>
      <td>Austria</td>
      <td>F</td>
      <td>1990</td>
      <td>8038.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AT13</td>
      <td>Austria</td>
      <td>F</td>
      <td>1990</td>
      <td>7240.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>AT21</td>
      <td>Austria</td>
      <td>F</td>
      <td>1990</td>
      <td>3042.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>AT22</td>
      <td>Austria</td>
      <td>F</td>
      <td>1990</td>
      <td>6491.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>
#+end_export



#+begin_src jupyter-python :display plain
@np.vectorize
def age_to_age_category(age):
    if age < 16:
        cat = 'Y0-15'
    elif age < 25:
        cat = 'Y16-24'
    elif age < 35:
        cat = 'Y25-34'
    elif age < 45:
        cat = 'Y35-44'
    elif age < 55:
        cat = 'Y45-54'
    elif age < 65:
        cat = 'Y55-64'
    elif age < 75:
        cat = 'Y65-74'
    elif age < 85:
        cat = 'Y75-84'
    else:
        cat = 'Y_GE85'
    return cat
df['age_category'] = age_to_age_category(df.age)
df.head()
#+end_src




#+RESULTS:
:   nuts2  country sex  year  population  age age_category
: 2  AT11  Austria   F  1990      1345.0  1.0        Y0-15
: 3  AT12  Austria   F  1990      8038.0  1.0        Y0-15
: 4  AT13  Austria   F  1990      7240.0  1.0        Y0-15
: 6  AT21  Austria   F  1990      3042.0  1.0        Y0-15
: 7  AT22  Austria   F  1990      6491.0  1.0        Y0-15



**** self-perceived health

- https://ec.europa.eu/eurostat/databrowser/view/hlth_silc_02/default/table?lang=en

- we combine bad and very bad self perceived health

#+begin_src jupyter-python :display plain
ages = ['Y16-24', 'Y25-34', 'Y35-44', 'Y45-54', 'Y55-64',
        'Y65-74', 'Y75-84', 'Y_GE85']
df_c = eurostat.get_data_df('hlth_silc_02')
df_c.rename({'geo\\time':'geo'},inplace=True,axis=1)
df_c['country'] = df_c['geo'].replace(eurostat_dictionary)
df_c = df_c[df_c.country.isin(EU_countries) & (df_c.sex.isin(["M","F"]) ) & (df_c.levels.isin(["B_VB"])) & (df_c.isced11 == "TOTAL") & df_c.age.isin(ages)]
df_c.drop(["unit","isced11","geo","levels"],axis=1,inplace=True)
df_c = pd.melt(df_c,id_vars=['country','sex','age'],
                        value_vars=np.arange(2008,2023),
                        var_name='year',value_name='bad_self_perceived_health')
# df_c.set_index(['country','year','sex','mortalit'],inplace=True)
# df_c = df_c.unstack()
# df_c.reset_index(inplace=True)
# df_c.columns = [' '.join(col).strip() for col in df_c.columns.values]
df_c.rename({'age':'age_category'},inplace=True,axis=1)
# df_c.to_csv('./data/preventable_mortality.csv')
df_c.head()
#+end_src

#+RESULTS:
:        country sex age_category  year  bad_self_perceived_health
: 0      Austria   F       Y16-24  2008                        1.0
: 1      Belgium   F       Y16-24  2008                        1.8
: 2     Bulgaria   F       Y16-24  2008                        0.9
: 3  Switzerland   F       Y16-24  2008                        0.9
: 4       Cyprus   F       Y16-24  2008                        0.2


#+begin_src jupyter-python :display plain
df = df.merge(df_c, how = 'left',\
              on = ['country','year','sex','age_category'])
df.set_index(['nuts2','year','sex','age'],inplace=True)
df.tail()
#+end_src

#+RESULTS:
#+begin_example
                            country  population age_category  \
nuts2 year sex age                                             
UKM6  2020 M   99.0  United Kingdom         NaN       Y_GE85   
UKM7  2020 M   99.0  United Kingdom         NaN       Y_GE85   
UKM8  2020 M   99.0  United Kingdom         NaN       Y_GE85   
UKM9  2020 M   99.0  United Kingdom         NaN       Y_GE85   
UKN0  2020 M   99.0  United Kingdom         NaN       Y_GE85   

                     bad_self_perceived_health  
nuts2 year sex age                              
UKM6  2020 M   99.0                        NaN  
UKM7  2020 M   99.0                        NaN  
UKM8  2020 M   99.0                        NaN  
UKM9  2020 M   99.0                        NaN  
UKN0  2020 M   99.0                        NaN  
#+end_example






#+begin_src jupyter-python 
ds = df.to_xarray()
ds.to_netcdf("./data/population_nuts_2.nc")
ds
#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:                    (age: 99, nuts2: 306, sex: 2, year: 31)
Coordinates:
  * nuts2                      (nuts2) object &#x27;AT11&#x27; &#x27;AT12&#x27; ... &#x27;UKM9&#x27; &#x27;UKN0&#x27;
  * year                       (year) int64 1990 1991 1992 ... 2018 2019 2020
  * sex                        (sex) object &#x27;F&#x27; &#x27;M&#x27;
  * age                        (age) float64 1.0 2.0 3.0 4.0 ... 97.0 98.0 99.0
Data variables:
    country                    (nuts2, year, sex, age) object &#x27;Austria&#x27; ... &#x27;...
    population                 (nuts2, year, sex, age) float64 1.345e+03 ... nan
    age_category               (nuts2, year, sex, age) object &#x27;Y0-15&#x27; ... &#x27;Y_...
    bad_self_perceived_health  (nuts2, year, sex, age) float64 nan nan ... nan</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-55f31315-cf87-4984-9507-4336123c2ce3' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-55f31315-cf87-4984-9507-4336123c2ce3' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>age</span>: 99</li><li><span class='xr-has-index'>nuts2</span>: 306</li><li><span class='xr-has-index'>sex</span>: 2</li><li><span class='xr-has-index'>year</span>: 31</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-abd5e9df-08e5-4ef2-baa3-6a5200243925' class='xr-section-summary-in' type='checkbox'  checked><label for='section-abd5e9df-08e5-4ef2-baa3-6a5200243925' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>nuts2</span></div><div class='xr-var-dims'>(nuts2)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;AT11&#x27; &#x27;AT12&#x27; ... &#x27;UKM9&#x27; &#x27;UKN0&#x27;</div><input id='attrs-45497dca-67db-4eb7-b736-ae79bccff015' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-45497dca-67db-4eb7-b736-ae79bccff015' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a890fe3c-324d-491e-b647-7e2217bbde6e' class='xr-var-data-in' type='checkbox'><label for='data-a890fe3c-324d-491e-b647-7e2217bbde6e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AT11&#x27;, &#x27;AT12&#x27;, &#x27;AT13&#x27;, ..., &#x27;UKM8&#x27;, &#x27;UKM9&#x27;, &#x27;UKN0&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1990 1991 1992 ... 2018 2019 2020</div><input id='attrs-f54443bc-ed35-4d7e-899e-4af6547aec76' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f54443bc-ed35-4d7e-899e-4af6547aec76' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9e95f05f-6f78-4ec6-9255-f845e7603a59' class='xr-var-data-in' type='checkbox'><label for='data-9e95f05f-6f78-4ec6-9255-f845e7603a59' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001,
       2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013,
       2014, 2015, 2016, 2017, 2018, 2019, 2020])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>sex</span></div><div class='xr-var-dims'>(sex)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;F&#x27; &#x27;M&#x27;</div><input id='attrs-29c1c830-ce72-4845-a3c4-a9b2a62cfdcf' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-29c1c830-ce72-4845-a3c4-a9b2a62cfdcf' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c229c9b2-22f9-4a47-820b-e7f1b5b2fcd9' class='xr-var-data-in' type='checkbox'><label for='data-c229c9b2-22f9-4a47-820b-e7f1b5b2fcd9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;F&#x27;, &#x27;M&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>age</span></div><div class='xr-var-dims'>(age)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.0 2.0 3.0 4.0 ... 97.0 98.0 99.0</div><input id='attrs-e80f048c-cb26-42a7-8160-f41231b52db8' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e80f048c-cb26-42a7-8160-f41231b52db8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e1410146-c8c6-4546-8323-d0cafaf142b7' class='xr-var-data-in' type='checkbox'><label for='data-e1410146-c8c6-4546-8323-d0cafaf142b7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9., 10., 11., 12., 13., 14.,
       15., 16., 17., 18., 19., 20., 21., 22., 23., 24., 25., 26., 27., 28.,
       29., 30., 31., 32., 33., 34., 35., 36., 37., 38., 39., 40., 41., 42.,
       43., 44., 45., 46., 47., 48., 49., 50., 51., 52., 53., 54., 55., 56.,
       57., 58., 59., 60., 61., 62., 63., 64., 65., 66., 67., 68., 69., 70.,
       71., 72., 73., 74., 75., 76., 77., 78., 79., 80., 81., 82., 83., 84.,
       85., 86., 87., 88., 89., 90., 91., 92., 93., 94., 95., 96., 97., 98.,
       99.])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-624254b6-84d9-4668-9c58-beca19bb88b1' class='xr-section-summary-in' type='checkbox'  checked><label for='section-624254b6-84d9-4668-9c58-beca19bb88b1' class='xr-section-summary' >Data variables: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>country</span></div><div class='xr-var-dims'>(nuts2, year, sex, age)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;Austria&#x27; ... &#x27;United Kingdom&#x27;</div><input id='attrs-542b19ef-1838-4cab-a14e-709c77e69723' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-542b19ef-1838-4cab-a14e-709c77e69723' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-baf4a3a1-ba22-441e-b27d-fb7058102f27' class='xr-var-data-in' type='checkbox'><label for='data-baf4a3a1-ba22-441e-b27d-fb7058102f27' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[[&#x27;Austria&#x27;, &#x27;Austria&#x27;, &#x27;Austria&#x27;, ..., &#x27;Austria&#x27;, &#x27;Austria&#x27;,
          &#x27;Austria&#x27;],
         [&#x27;Austria&#x27;, &#x27;Austria&#x27;, &#x27;Austria&#x27;, ..., &#x27;Austria&#x27;, &#x27;Austria&#x27;,
          &#x27;Austria&#x27;]],

        [[&#x27;Austria&#x27;, &#x27;Austria&#x27;, &#x27;Austria&#x27;, ..., &#x27;Austria&#x27;, &#x27;Austria&#x27;,
          &#x27;Austria&#x27;],
         [&#x27;Austria&#x27;, &#x27;Austria&#x27;, &#x27;Austria&#x27;, ..., &#x27;Austria&#x27;, &#x27;Austria&#x27;,
          &#x27;Austria&#x27;]],

        [[&#x27;Austria&#x27;, &#x27;Austria&#x27;, &#x27;Austria&#x27;, ..., &#x27;Austria&#x27;, &#x27;Austria&#x27;,
          &#x27;Austria&#x27;],
         [&#x27;Austria&#x27;, &#x27;Austria&#x27;, &#x27;Austria&#x27;, ..., &#x27;Austria&#x27;, &#x27;Austria&#x27;,
          &#x27;Austria&#x27;]],

        ...,

        [[&#x27;Austria&#x27;, &#x27;Austria&#x27;, &#x27;Austria&#x27;, ..., &#x27;Austria&#x27;, &#x27;Austria&#x27;,
          &#x27;Austria&#x27;],
         [&#x27;Austria&#x27;, &#x27;Austria&#x27;, &#x27;Austria&#x27;, ..., &#x27;Austria&#x27;, &#x27;Austria&#x27;,
...
         [&#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, ...,
          &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;]],

        ...,

        [[&#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, ...,
          &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;],
         [&#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, ...,
          &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;]],

        [[&#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, ...,
          &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;],
         [&#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, ...,
          &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;]],

        [[&#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, ...,
          &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;],
         [&#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, ...,
          &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;]]]],
      dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>population</span></div><div class='xr-var-dims'>(nuts2, year, sex, age)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.345e+03 1.349e+03 ... nan nan</div><input id='attrs-4bc1a299-7be2-4ff9-8c25-963971bee3c9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4bc1a299-7be2-4ff9-8c25-963971bee3c9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-21b371ad-376f-4bfa-b885-f07499fdc49a' class='xr-var-data-in' type='checkbox'><label for='data-21b371ad-376f-4bfa-b885-f07499fdc49a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[[1.3450e+03, 1.3490e+03, 1.4070e+03, ...,        nan,
                 nan,        nan],
         [1.4380e+03, 1.4500e+03, 1.4920e+03, ...,        nan,
                 nan,        nan]],

        [[1.3710e+03, 1.3760e+03, 1.3810e+03, ...,        nan,
                 nan,        nan],
         [1.4550e+03, 1.4660e+03, 1.4700e+03, ...,        nan,
                 nan,        nan]],

        [[1.4360e+03, 1.4140e+03, 1.4260e+03, ...,        nan,
                 nan,        nan],
         [1.4280e+03, 1.4940e+03, 1.5070e+03, ...,        nan,
                 nan,        nan]],

        ...,

        [[1.1630e+03, 1.1810e+03, 1.1690e+03, ..., 7.4000e+01,
          3.7000e+01, 1.9000e+01],
         [1.2910e+03, 1.2630e+03, 1.3150e+03, ..., 1.7000e+01,
...
                 nan,        nan],
         [1.3305e+04, 1.3199e+04, 1.3380e+04, ...,        nan,
                 nan,        nan]],

        ...,

        [[1.1730e+04, 1.1970e+04, 1.2065e+04, ..., 3.6600e+02,
          2.2800e+02, 1.3400e+02],
         [1.2481e+04, 1.2764e+04, 1.2681e+04, ..., 1.1300e+02,
          4.2000e+01, 3.3000e+01]],

        [[       nan,        nan,        nan, ...,        nan,
                 nan,        nan],
         [       nan,        nan,        nan, ...,        nan,
                 nan,        nan]],

        [[       nan,        nan,        nan, ...,        nan,
                 nan,        nan],
         [       nan,        nan,        nan, ...,        nan,
                 nan,        nan]]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>age_category</span></div><div class='xr-var-dims'>(nuts2, year, sex, age)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;Y0-15&#x27; &#x27;Y0-15&#x27; ... &#x27;Y_GE85&#x27;</div><input id='attrs-66e7f468-c21e-428d-b5ad-6808a97604cb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-66e7f468-c21e-428d-b5ad-6808a97604cb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9b47fe9f-2ea5-4d78-b829-bc7417bbe1fc' class='xr-var-data-in' type='checkbox'><label for='data-9b47fe9f-2ea5-4d78-b829-bc7417bbe1fc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;]],

        [[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;]],

        [[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;]],

        ...,

        [[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;]],

        [[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;]],

        [[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;]]],

...
       [[[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;]],

        [[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;]],

        [[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;]],

        ...,

        [[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;]],

        [[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;]],

        [[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;]]]],
      dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>bad_self_perceived_health</span></div><div class='xr-var-dims'>(nuts2, year, sex, age)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-db4b2fac-1114-4c2d-b8ea-7583212af5c5' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-db4b2fac-1114-4c2d-b8ea-7583212af5c5' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f06a2dd4-1352-4559-8551-88b7209b29ec' class='xr-var-data-in' type='checkbox'><label for='data-f06a2dd4-1352-4559-8551-88b7209b29ec' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

        [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

        [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

        ...,

        [[ nan,  nan,  nan, ..., 38.5, 38.5, 38.5],
         [ nan,  nan,  nan, ..., 34.7, 34.7, 34.7]],

        [[ nan,  nan,  nan, ..., 42.6, 42.6, 42.6],
         [ nan,  nan,  nan, ..., 32.1, 32.1, 32.1]],

        [[ nan,  nan,  nan, ..., 38.9, 38.9, 38.9],
         [ nan,  nan,  nan, ..., 31. , 31. , 31. ]]],

...

       [[[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

        [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

        [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

        ...,

        [[ nan,  nan,  nan, ..., 17.6, 17.6, 17.6],
         [ nan,  nan,  nan, ..., 14.5, 14.5, 14.5]],

        [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

        [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]]]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-ee2faa1c-e8dc-4b34-bdb7-5085c713f455' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-ee2faa1c-e8dc-4b34-bdb7-5085c713f455' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export



- deaths: https://ec.europa.eu/eurostat/databrowser/view/demo_r_magec/default/table?lang=en


#+begin_src jupyter-python 
df = eurostat.get_data_df('demo_r_magec')
df.rename({'geo\\time':'geo'},inplace=True,axis=1)
age_range = ['Y1', 'Y10', 'Y11', 'Y12', 'Y13', 'Y14', 'Y15',
       'Y16', 'Y17', 'Y18', 'Y19', 'Y2', 'Y20', 'Y21', 'Y22', 'Y23',
       'Y24', 'Y25', 'Y26', 'Y27', 'Y28', 'Y29', 'Y3', 'Y30', 'Y31',
       'Y32', 'Y33', 'Y34', 'Y35', 'Y36', 'Y37', 'Y38', 'Y39', 'Y4',
       'Y40', 'Y41', 'Y42', 'Y43', 'Y44', 'Y45', 'Y46', 'Y47', 'Y48',
       'Y49', 'Y5', 'Y50', 'Y51', 'Y52', 'Y53', 'Y54', 'Y55', 'Y56',
       'Y57', 'Y58', 'Y59', 'Y6', 'Y60', 'Y61', 'Y62', 'Y63', 'Y64',
       'Y65', 'Y66', 'Y67', 'Y68', 'Y69', 'Y7', 'Y70', 'Y71', 'Y72',
       'Y73', 'Y74', 'Y75', 'Y76', 'Y77', 'Y78', 'Y79', 'Y8', 'Y80',
       'Y81', 'Y82', 'Y83', 'Y84', 'Y85', 'Y86', 'Y87', 'Y88', 'Y89',
       'Y9', 'Y90', 'Y91', 'Y92', 'Y93', 'Y94', 'Y95', 'Y96', 'Y97',
       'Y98', 'Y99']
df['country_code'] = [x[:2] for x in df['geo']]
df['country'] = df['country_code'].replace(eurostat_dictionary)
df = df[df.country.isin(EU_countries) & \
        (df.sex.isin(["M","F"])) & (df.age.isin(age_range))]
df.drop(['country','country_code'],axis=1,inplace=True)
df = pd.melt(df,id_vars=['geo','sex','age'],
                        value_vars=np.arange(1990,2020),
                        var_name='year',value_name='deaths')
df['nuts'] = [len(x)-2 for x in df.geo]
df = df.query('nuts == 2')
df.drop('nuts',inplace=True, axis=1)
df.rename({'geo':'nuts2', 'age':'age string'},\
          axis=1,inplace=True)
df['age'] = [float(x.replace('Y','')) for x in df['age string']]
df.drop('age string',inplace=True, axis=1)

df.set_index(['nuts2','year','sex','age'],inplace=True)

df.head()
#+end_src

#+RESULTS:
#+begin_export html
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>deaths</th>
    </tr>
    <tr>
      <th>nuts2</th>
      <th>year</th>
      <th>sex</th>
      <th>age</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AT11</th>
      <th>1990</th>
      <th>F</th>
      <th>1.0</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>AT12</th>
      <th>1990</th>
      <th>F</th>
      <th>1.0</th>
      <td>7.0</td>
    </tr>
    <tr>
      <th>AT13</th>
      <th>1990</th>
      <th>F</th>
      <th>1.0</th>
      <td>4.0</td>
    </tr>
    <tr>
      <th>AT21</th>
      <th>1990</th>
      <th>F</th>
      <th>1.0</th>
      <td>1.0</td>
    </tr>
    <tr>
      <th>AT22</th>
      <th>1990</th>
      <th>F</th>
      <th>1.0</th>
      <td>5.0</td>
    </tr>
  </tbody>
</table>
</div>
#+end_export



#+begin_src jupyter-python 
ds = df.to_xarray()
ds.to_netcdf("./data/deaths_nuts_2.nc")
ds
#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:  (age: 99, nuts2: 305, sex: 2, year: 30)
Coordinates:
  * nuts2    (nuts2) object &#x27;AT11&#x27; &#x27;AT12&#x27; &#x27;AT13&#x27; &#x27;AT21&#x27; ... &#x27;UKM8&#x27; &#x27;UKM9&#x27; &#x27;UKN0&#x27;
  * year     (year) int64 1990 1991 1992 1993 1994 ... 2015 2016 2017 2018 2019
  * sex      (sex) object &#x27;F&#x27; &#x27;M&#x27;
  * age      (age) float64 1.0 2.0 3.0 4.0 5.0 6.0 ... 95.0 96.0 97.0 98.0 99.0
Data variables:
    deaths   (nuts2, year, sex, age) float64 0.0 0.0 1.0 1.0 ... nan nan nan nan</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-8d8436b6-d09e-4280-9c14-e1c27052a41f' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-8d8436b6-d09e-4280-9c14-e1c27052a41f' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>age</span>: 99</li><li><span class='xr-has-index'>nuts2</span>: 305</li><li><span class='xr-has-index'>sex</span>: 2</li><li><span class='xr-has-index'>year</span>: 30</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-b6489122-be14-4541-83ce-20c67bda5dfa' class='xr-section-summary-in' type='checkbox'  checked><label for='section-b6489122-be14-4541-83ce-20c67bda5dfa' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>nuts2</span></div><div class='xr-var-dims'>(nuts2)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;AT11&#x27; &#x27;AT12&#x27; ... &#x27;UKM9&#x27; &#x27;UKN0&#x27;</div><input id='attrs-727da0c0-543b-4b1b-bc0c-5a314c1ab575' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-727da0c0-543b-4b1b-bc0c-5a314c1ab575' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-752b6d66-18a4-4c8b-89b0-83730a005c67' class='xr-var-data-in' type='checkbox'><label for='data-752b6d66-18a4-4c8b-89b0-83730a005c67' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AT11&#x27;, &#x27;AT12&#x27;, &#x27;AT13&#x27;, ..., &#x27;UKM8&#x27;, &#x27;UKM9&#x27;, &#x27;UKN0&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1990 1991 1992 ... 2017 2018 2019</div><input id='attrs-e26cb964-2b72-4929-8c12-99cc1769f465' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e26cb964-2b72-4929-8c12-99cc1769f465' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-81f893d8-705a-4d8d-92a9-91a5e8579b42' class='xr-var-data-in' type='checkbox'><label for='data-81f893d8-705a-4d8d-92a9-91a5e8579b42' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001,
       2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013,
       2014, 2015, 2016, 2017, 2018, 2019])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>sex</span></div><div class='xr-var-dims'>(sex)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;F&#x27; &#x27;M&#x27;</div><input id='attrs-e4aeaf74-9830-4672-ae02-91e823669aa9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e4aeaf74-9830-4672-ae02-91e823669aa9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4edf373d-b2d3-441c-b403-f4d6a661bcae' class='xr-var-data-in' type='checkbox'><label for='data-4edf373d-b2d3-441c-b403-f4d6a661bcae' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;F&#x27;, &#x27;M&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>age</span></div><div class='xr-var-dims'>(age)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.0 2.0 3.0 4.0 ... 97.0 98.0 99.0</div><input id='attrs-2e84b16f-0194-4fe3-94a5-6d15db292330' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2e84b16f-0194-4fe3-94a5-6d15db292330' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-227d5e63-c8e9-4a2b-b896-cbc563b3a3d6' class='xr-var-data-in' type='checkbox'><label for='data-227d5e63-c8e9-4a2b-b896-cbc563b3a3d6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9., 10., 11., 12., 13., 14.,
       15., 16., 17., 18., 19., 20., 21., 22., 23., 24., 25., 26., 27., 28.,
       29., 30., 31., 32., 33., 34., 35., 36., 37., 38., 39., 40., 41., 42.,
       43., 44., 45., 46., 47., 48., 49., 50., 51., 52., 53., 54., 55., 56.,
       57., 58., 59., 60., 61., 62., 63., 64., 65., 66., 67., 68., 69., 70.,
       71., 72., 73., 74., 75., 76., 77., 78., 79., 80., 81., 82., 83., 84.,
       85., 86., 87., 88., 89., 90., 91., 92., 93., 94., 95., 96., 97., 98.,
       99.])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-3f3d1045-42f6-468c-b2b0-f1166b41655c' class='xr-section-summary-in' type='checkbox'  checked><label for='section-3f3d1045-42f6-468c-b2b0-f1166b41655c' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>deaths</span></div><div class='xr-var-dims'>(nuts2, year, sex, age)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.0 0.0 1.0 1.0 ... nan nan nan nan</div><input id='attrs-47d1b75c-0a3a-4c5a-85cb-b267432a2f58' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-47d1b75c-0a3a-4c5a-85cb-b267432a2f58' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-188dae3d-8f61-4c6a-a80c-1be9acbf227f' class='xr-var-data-in' type='checkbox'><label for='data-188dae3d-8f61-4c6a-a80c-1be9acbf227f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[[  0.,   0.,   1., ...,  nan,  nan,  nan],
         [  2.,   0.,   0., ...,  nan,  nan,  nan]],

        [[  0.,   1.,   0., ...,  nan,  nan,  nan],
         [  3.,   0.,   0., ...,  nan,  nan,  nan]],

        [[  1.,   0.,   1., ...,  nan,  nan,  nan],
         [  1.,   0.,   1., ...,  nan,  nan,  nan]],

        ...,

        [[  0.,   0.,   0., ...,  31.,  12.,   4.],
         [  0.,   0.,   0., ...,  11.,   5.,   3.]],

        [[  2.,   0.,   0., ...,  25.,  17.,   5.],
         [  1.,   0.,   0., ...,   3.,   4.,   1.]],

        [[  0.,   0.,   0., ...,  36.,  21.,  16.],
         [  0.,   1.,   0., ...,  12.,   5.,   5.]]],

...

       [[[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

        [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

        [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

        ...,

        [[  1.,   3.,   0., ..., 122.,  84.,  54.],
         [  4.,   2.,   1., ...,  39.,  28.,  17.]],

        [[  2.,   2.,   0., ..., 139.,  69.,  57.],
         [  1.,   1.,   2., ...,  48.,  26.,  18.]],

        [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]]]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-8f6419c8-eaa8-47a2-85a2-fd90ff7eebe9' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-8f6419c8-eaa8-47a2-85a2-fd90ff7eebe9' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export


*** mortality lagged per age

- useful link to lag variables in a pandas dataframe: https://stackoverflow.com/questions/61234837/pandas-panel-data-shifting-values-by-two-taking-into-consideration-year-gaps

#+begin_src jupyter-python 

ds_population = xr.open_dataset('./data/population_nuts_2.nc')
ds_deaths =  xr.open_dataset('./data/deaths_nuts_2.nc')

ds_mortality = xr.merge([ds_population, ds_deaths])
ds_mortality
#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:     (age: 99, nuts2: 305, sex: 2, year: 31)
Coordinates:
  * year        (year) int64 1990 1991 1992 1993 1994 ... 2017 2018 2019 2020
  * nuts2       (nuts2) object &#x27;AT11&#x27; &#x27;AT12&#x27; &#x27;AT13&#x27; ... &#x27;UKM8&#x27; &#x27;UKM9&#x27; &#x27;UKN0&#x27;
  * sex         (sex) object &#x27;F&#x27; &#x27;M&#x27;
  * age         (age) float64 1.0 2.0 3.0 4.0 5.0 ... 95.0 96.0 97.0 98.0 99.0
Data variables:
    population  (nuts2, year, sex, age) float64 ...
    deaths      (nuts2, year, sex, age) float64 0.0 0.0 1.0 1.0 ... nan nan nan</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-01b03e30-00b3-4c0f-8051-1f41938b2037' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-01b03e30-00b3-4c0f-8051-1f41938b2037' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>age</span>: 99</li><li><span class='xr-has-index'>nuts2</span>: 305</li><li><span class='xr-has-index'>sex</span>: 2</li><li><span class='xr-has-index'>year</span>: 31</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-80e0ca89-4c42-451a-8c46-babfd0e383ea' class='xr-section-summary-in' type='checkbox'  checked><label for='section-80e0ca89-4c42-451a-8c46-babfd0e383ea' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1990 1991 1992 ... 2018 2019 2020</div><input id='attrs-d7939a8e-4b9b-4114-b09f-688c2db447d2' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d7939a8e-4b9b-4114-b09f-688c2db447d2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3ddd44f0-79a9-48f4-815a-f98564d5462b' class='xr-var-data-in' type='checkbox'><label for='data-3ddd44f0-79a9-48f4-815a-f98564d5462b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001,
       2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013,
       2014, 2015, 2016, 2017, 2018, 2019, 2020])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>nuts2</span></div><div class='xr-var-dims'>(nuts2)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;AT11&#x27; &#x27;AT12&#x27; ... &#x27;UKM9&#x27; &#x27;UKN0&#x27;</div><input id='attrs-9293121d-cf9d-4691-8eb5-ed2fb173fb1d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9293121d-cf9d-4691-8eb5-ed2fb173fb1d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ddbbdc27-73fe-40f7-b42d-5d0c7bdfb433' class='xr-var-data-in' type='checkbox'><label for='data-ddbbdc27-73fe-40f7-b42d-5d0c7bdfb433' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AT11&#x27;, &#x27;AT12&#x27;, &#x27;AT13&#x27;, ..., &#x27;UKM8&#x27;, &#x27;UKM9&#x27;, &#x27;UKN0&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>sex</span></div><div class='xr-var-dims'>(sex)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;F&#x27; &#x27;M&#x27;</div><input id='attrs-1f33e218-783c-42b4-872c-8532f80b98f6' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-1f33e218-783c-42b4-872c-8532f80b98f6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1b31bff8-8100-4417-b060-590e03577986' class='xr-var-data-in' type='checkbox'><label for='data-1b31bff8-8100-4417-b060-590e03577986' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;F&#x27;, &#x27;M&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>age</span></div><div class='xr-var-dims'>(age)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.0 2.0 3.0 4.0 ... 97.0 98.0 99.0</div><input id='attrs-f6a64ce1-7fbe-4b9c-a91b-c9dc31b2d1b8' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f6a64ce1-7fbe-4b9c-a91b-c9dc31b2d1b8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a1e354d4-4cfc-42dc-8bbe-4e9b0f32338d' class='xr-var-data-in' type='checkbox'><label for='data-a1e354d4-4cfc-42dc-8bbe-4e9b0f32338d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ 1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9., 10., 11., 12., 13., 14.,
       15., 16., 17., 18., 19., 20., 21., 22., 23., 24., 25., 26., 27., 28.,
       29., 30., 31., 32., 33., 34., 35., 36., 37., 38., 39., 40., 41., 42.,
       43., 44., 45., 46., 47., 48., 49., 50., 51., 52., 53., 54., 55., 56.,
       57., 58., 59., 60., 61., 62., 63., 64., 65., 66., 67., 68., 69., 70.,
       71., 72., 73., 74., 75., 76., 77., 78., 79., 80., 81., 82., 83., 84.,
       85., 86., 87., 88., 89., 90., 91., 92., 93., 94., 95., 96., 97., 98.,
       99.])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-8df57e97-4000-480a-ae54-ab94b80dbfa5' class='xr-section-summary-in' type='checkbox'  checked><label for='section-8df57e97-4000-480a-ae54-ab94b80dbfa5' class='xr-section-summary' >Data variables: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>population</span></div><div class='xr-var-dims'>(nuts2, year, sex, age)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-2654d66e-bdf8-4a21-b03c-a73d1300af41' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2654d66e-bdf8-4a21-b03c-a73d1300af41' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bfcd2988-7d9c-4ac4-ae12-9ad7ce6673aa' class='xr-var-data-in' type='checkbox'><label for='data-bfcd2988-7d9c-4ac4-ae12-9ad7ce6673aa' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[1872090 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>deaths</span></div><div class='xr-var-dims'>(nuts2, year, sex, age)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.0 0.0 1.0 1.0 ... nan nan nan nan</div><input id='attrs-04aaf797-02d6-4de0-a0d3-8604ac121b69' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-04aaf797-02d6-4de0-a0d3-8604ac121b69' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4e87bf3c-0bfd-4086-b034-2a92bfacb011' class='xr-var-data-in' type='checkbox'><label for='data-4e87bf3c-0bfd-4086-b034-2a92bfacb011' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[[  0.,   0.,   1., ...,  nan,  nan,  nan],
         [  2.,   0.,   0., ...,  nan,  nan,  nan]],

        [[  0.,   1.,   0., ...,  nan,  nan,  nan],
         [  3.,   0.,   0., ...,  nan,  nan,  nan]],

        [[  1.,   0.,   1., ...,  nan,  nan,  nan],
         [  1.,   0.,   1., ...,  nan,  nan,  nan]],

        ...,

        [[  2.,   0.,   0., ...,  25.,  17.,   5.],
         [  1.,   0.,   0., ...,   3.,   4.,   1.]],

        [[  0.,   0.,   0., ...,  36.,  21.,  16.],
         [  0.,   1.,   0., ...,  12.,   5.,   5.]],

        [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]]],

...

       [[[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

        [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

        [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

        ...,

        [[  2.,   2.,   0., ..., 139.,  69.,  57.],
         [  1.,   1.,   2., ...,  48.,  26.,  18.]],

        [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

        [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
         [ nan,  nan,  nan, ...,  nan,  nan,  nan]]]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-c193890b-2e3f-4e77-8b87-6f510f40fd95' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-c193890b-2e3f-4e77-8b87-6f510f40fd95' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export




#+begin_src jupyter-python 
df_mortality = ds_mortality.to_dataframe()
# drop rows where deaths > population at Jan. 1st
# (e.g. because people moved in the year)
df_mortality = df_mortality[(df_mortality.population >= \
                             df_mortality.deaths) &\
                            (df_mortality.population > 0)]
df_mortality['mortality'] = df_mortality['deaths']/\
    df_mortality['population']
df_mortality.reset_index(inplace=True)
df_mortality.rename({'level_3':'year'},\
                    inplace=True,axis=1)
df_mortality['year'] = pd.to_datetime(df_mortality['year'],\
                                      format='%Y')
df_mortality.head()
#+end_src

#+RESULTS:
#+begin_export html
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>nuts2</th>
      <th>sex</th>
      <th>year</th>
      <th>population</th>
      <th>deaths</th>
      <th>mortality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>AT11</td>
      <td>F</td>
      <td>1990-01-01</td>
      <td>1345.0</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>AT11</td>
      <td>F</td>
      <td>1991-01-01</td>
      <td>1371.0</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>AT11</td>
      <td>F</td>
      <td>1992-01-01</td>
      <td>1436.0</td>
      <td>1.0</td>
      <td>0.000696</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>AT11</td>
      <td>F</td>
      <td>1993-01-01</td>
      <td>1372.0</td>
      <td>0.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>AT11</td>
      <td>F</td>
      <td>1994-01-01</td>
      <td>1349.0</td>
      <td>1.0</td>
      <td>0.000741</td>
    </tr>
  </tbody>
</table>
</div>
#+end_export

#+begin_src jupyter-python 
new_column = (df_mortality.set_index(['year','age','nuts2','sex']).\
              groupby(['age','nuts2','sex'])['mortality']\
              .shift(1)).to_frame()
new_column.reset_index(inplace=True)
new_column.age += 1
new_column['year'] = new_column['year'].dt.year
new_column.rename({'mortality':'lagged_mortality'},\
                  inplace=True,axis=1)
new_column.set_index(['year','age','nuts2','sex'],\
                     inplace=True)
new_column.head()
#+end_src

#+RESULTS:
#+begin_export html
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>lagged_mortality</th>
    </tr>
    <tr>
      <th>year</th>
      <th>age</th>
      <th>nuts2</th>
      <th>sex</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1990</th>
      <th>2.0</th>
      <th>AT11</th>
      <th>F</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1991</th>
      <th>2.0</th>
      <th>AT11</th>
      <th>F</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1992</th>
      <th>2.0</th>
      <th>AT11</th>
      <th>F</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1993</th>
      <th>2.0</th>
      <th>AT11</th>
      <th>F</th>
      <td>0.000696</td>
    </tr>
    <tr>
      <th>1994</th>
      <th>2.0</th>
      <th>AT11</th>
      <th>F</th>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>
#+end_export

#+begin_src jupyter-python 
ds = new_column.to_xarray()
ds.to_netcdf("./data/lagged_mortality_nuts_2.nc")
ds
#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:           (age: 99, nuts2: 297, sex: 2, year: 30)
Coordinates:
  * year              (year) int64 1990 1991 1992 1993 ... 2016 2017 2018 2019
  * age               (age) float64 2.0 3.0 4.0 5.0 6.0 ... 97.0 98.0 99.0 100.0
  * nuts2             (nuts2) object &#x27;AT11&#x27; &#x27;AT12&#x27; &#x27;AT13&#x27; ... &#x27;UKM9&#x27; &#x27;UKN0&#x27;
  * sex               (sex) object &#x27;F&#x27; &#x27;M&#x27;
Data variables:
    lagged_mortality  (year, age, nuts2, sex) float64 nan nan nan ... nan nan</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-800b09d3-7f48-4cc7-b906-e7e378d0478c' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-800b09d3-7f48-4cc7-b906-e7e378d0478c' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>age</span>: 99</li><li><span class='xr-has-index'>nuts2</span>: 297</li><li><span class='xr-has-index'>sex</span>: 2</li><li><span class='xr-has-index'>year</span>: 30</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-f1cba386-6a41-4ed0-8c24-91dc61d9f1c7' class='xr-section-summary-in' type='checkbox'  checked><label for='section-f1cba386-6a41-4ed0-8c24-91dc61d9f1c7' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1990 1991 1992 ... 2017 2018 2019</div><input id='attrs-2e9ceb52-0afc-4d55-af31-24894ce71a22' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2e9ceb52-0afc-4d55-af31-24894ce71a22' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-72e3f757-4452-4fea-9e05-d3b60b88d41f' class='xr-var-data-in' type='checkbox'><label for='data-72e3f757-4452-4fea-9e05-d3b60b88d41f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001,
       2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013,
       2014, 2015, 2016, 2017, 2018, 2019])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>age</span></div><div class='xr-var-dims'>(age)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>2.0 3.0 4.0 5.0 ... 98.0 99.0 100.0</div><input id='attrs-4c97cb45-5190-485d-a2d0-691965f4731c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4c97cb45-5190-485d-a2d0-691965f4731c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-57d7172e-00cc-4912-868e-266428b72722' class='xr-var-data-in' type='checkbox'><label for='data-57d7172e-00cc-4912-868e-266428b72722' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([  2.,   3.,   4.,   5.,   6.,   7.,   8.,   9.,  10.,  11.,  12.,  13.,
        14.,  15.,  16.,  17.,  18.,  19.,  20.,  21.,  22.,  23.,  24.,  25.,
        26.,  27.,  28.,  29.,  30.,  31.,  32.,  33.,  34.,  35.,  36.,  37.,
        38.,  39.,  40.,  41.,  42.,  43.,  44.,  45.,  46.,  47.,  48.,  49.,
        50.,  51.,  52.,  53.,  54.,  55.,  56.,  57.,  58.,  59.,  60.,  61.,
        62.,  63.,  64.,  65.,  66.,  67.,  68.,  69.,  70.,  71.,  72.,  73.,
        74.,  75.,  76.,  77.,  78.,  79.,  80.,  81.,  82.,  83.,  84.,  85.,
        86.,  87.,  88.,  89.,  90.,  91.,  92.,  93.,  94.,  95.,  96.,  97.,
        98.,  99., 100.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>nuts2</span></div><div class='xr-var-dims'>(nuts2)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;AT11&#x27; &#x27;AT12&#x27; ... &#x27;UKM9&#x27; &#x27;UKN0&#x27;</div><input id='attrs-e83a6e3e-5cdf-4ae8-b1fd-ffba9d813bf9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e83a6e3e-5cdf-4ae8-b1fd-ffba9d813bf9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-724ff8d6-94b9-4a29-8f33-0e103ec34c23' class='xr-var-data-in' type='checkbox'><label for='data-724ff8d6-94b9-4a29-8f33-0e103ec34c23' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AT11&#x27;, &#x27;AT12&#x27;, &#x27;AT13&#x27;, ..., &#x27;UKM8&#x27;, &#x27;UKM9&#x27;, &#x27;UKN0&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>sex</span></div><div class='xr-var-dims'>(sex)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;F&#x27; &#x27;M&#x27;</div><input id='attrs-cad62634-5993-45cb-8bc0-f27870b45d7b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-cad62634-5993-45cb-8bc0-f27870b45d7b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e5c92785-6d1c-43e8-beb3-62cf86650176' class='xr-var-data-in' type='checkbox'><label for='data-e5c92785-6d1c-43e8-beb3-62cf86650176' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;F&#x27;, &#x27;M&#x27;], dtype=object)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-a4f9a1fa-08b7-44a1-bca5-92fb56dec640' class='xr-section-summary-in' type='checkbox'  checked><label for='section-a4f9a1fa-08b7-44a1-bca5-92fb56dec640' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>lagged_mortality</span></div><div class='xr-var-dims'>(year, age, nuts2, sex)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-eb335855-e786-4db9-a16a-bb165d884dc6' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-eb335855-e786-4db9-a16a-bb165d884dc6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7ae2ee47-3990-476b-990f-8286b80332d1' class='xr-var-data-in' type='checkbox'><label for='data-7ae2ee47-3990-476b-990f-8286b80332d1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[[           nan,            nan],
         [           nan,            nan],
         [           nan,            nan],
         ...,
         [           nan,            nan],
         [           nan,            nan],
         [           nan,            nan]],

        [[           nan,            nan],
         [           nan,            nan],
         [           nan,            nan],
         ...,
         [           nan,            nan],
         [           nan,            nan],
         [           nan,            nan]],

        [[           nan,            nan],
         [           nan,            nan],
         [           nan,            nan],
         ...,
...
         ...,
         [           nan,            nan],
         [           nan,            nan],
         [           nan,            nan]],

        [[4.59459459e-01, 1.00000000e+00],
         [4.08256881e-01, 4.20000000e-01],
         [3.94636015e-01, 4.82758621e-01],
         ...,
         [           nan,            nan],
         [           nan,            nan],
         [           nan,            nan]],

        [[2.63157895e-01,            nan],
         [4.78723404e-01, 6.84210526e-01],
         [4.25925926e-01, 6.00000000e-01],
         ...,
         [           nan,            nan],
         [           nan,            nan],
         [           nan,            nan]]]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-394eaf62-b712-492c-b9e1-8f931a8b012f' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-394eaf62-b712-492c-b9e1-8f931a8b012f' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export



*** Poverty measures


**** Severe material deprivation rate by NUTS 2 regions [TGS00104]

- link to the data: https://ec.europa.eu/eurostat/databrowser/view/tgs00104/default/table?lang=en

#+begin_src jupyter-python 
df = eurostat.get_data_df('tgs00104')
df.rename({'geo\\time':'nuts2'},inplace=True,axis=1)
df = df[(df.unit == "PC")]
df.drop(["unit"],axis=1,inplace=True)
df['nuts'] = [len(x)-2 for x in df.nuts2]
df = df[df.nuts == 2]
df.drop('nuts',axis=1,inplace=True)

df = pd.melt(df,id_vars=['nuts2'],
                        value_vars=np.arange(2009,2021),
                        var_name='year',\
             value_name='percentage_material_deprivation')
df.set_index(['nuts2','year'],inplace=True)
df.head()
#+end_src

#+RESULTS:
#+begin_export html
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>percentage_material_deprivation</th>
    </tr>
    <tr>
      <th>nuts2</th>
      <th>year</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AL01</th>
      <th>2009</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>AL02</th>
      <th>2009</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>AL03</th>
      <th>2009</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>AT11</th>
      <th>2009</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>AT12</th>
      <th>2009</th>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
#+end_export


#+begin_src jupyter-python 
ds_material_deprivation = df.to_xarray()
ds_material_deprivation.to_netcdf("./data/material_deprivation_nuts_2.nc")
ds_material_deprivation
#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:                          (nuts2: 179, year: 12)
Coordinates:
  * nuts2                            (nuts2) object &#x27;AL01&#x27; &#x27;AL02&#x27; ... &#x27;SK04&#x27;
  * year                             (year) int64 2009 2010 2011 ... 2019 2020
Data variables:
    percentage_material_deprivation  (nuts2, year) float64 nan nan ... 9.6 8.3</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-60ca8307-3f41-47b2-98de-8d309d5e40c3' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-60ca8307-3f41-47b2-98de-8d309d5e40c3' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>nuts2</span>: 179</li><li><span class='xr-has-index'>year</span>: 12</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-e265b081-1fcc-4bac-a8c4-0ad9a24d9c65' class='xr-section-summary-in' type='checkbox'  checked><label for='section-e265b081-1fcc-4bac-a8c4-0ad9a24d9c65' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>nuts2</span></div><div class='xr-var-dims'>(nuts2)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;AL01&#x27; &#x27;AL02&#x27; ... &#x27;SK03&#x27; &#x27;SK04&#x27;</div><input id='attrs-5dfd14bc-1c2d-4a73-b06c-5e48d5b2ec5a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-5dfd14bc-1c2d-4a73-b06c-5e48d5b2ec5a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b95a3807-5b27-4013-b0f0-975e759442c1' class='xr-var-data-in' type='checkbox'><label for='data-b95a3807-5b27-4013-b0f0-975e759442c1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AL01&#x27;, &#x27;AL02&#x27;, &#x27;AL03&#x27;, &#x27;AT11&#x27;, &#x27;AT12&#x27;, &#x27;AT13&#x27;, &#x27;AT21&#x27;, &#x27;AT22&#x27;, &#x27;AT31&#x27;,
       &#x27;AT32&#x27;, &#x27;AT33&#x27;, &#x27;AT34&#x27;, &#x27;BG31&#x27;, &#x27;BG32&#x27;, &#x27;BG33&#x27;, &#x27;BG34&#x27;, &#x27;BG41&#x27;, &#x27;BG42&#x27;,
       &#x27;CH01&#x27;, &#x27;CH02&#x27;, &#x27;CH03&#x27;, &#x27;CH04&#x27;, &#x27;CH05&#x27;, &#x27;CH06&#x27;, &#x27;CH07&#x27;, &#x27;CZ01&#x27;, &#x27;CZ02&#x27;,
       &#x27;CZ03&#x27;, &#x27;CZ04&#x27;, &#x27;CZ05&#x27;, &#x27;CZ06&#x27;, &#x27;CZ07&#x27;, &#x27;CZ08&#x27;, &#x27;DK01&#x27;, &#x27;DK02&#x27;, &#x27;DK03&#x27;,
       &#x27;DK04&#x27;, &#x27;DK05&#x27;, &#x27;EL30&#x27;, &#x27;EL41&#x27;, &#x27;EL42&#x27;, &#x27;EL43&#x27;, &#x27;EL51&#x27;, &#x27;EL52&#x27;, &#x27;EL53&#x27;,
       &#x27;EL54&#x27;, &#x27;EL61&#x27;, &#x27;EL62&#x27;, &#x27;EL63&#x27;, &#x27;EL64&#x27;, &#x27;EL65&#x27;, &#x27;ES11&#x27;, &#x27;ES12&#x27;, &#x27;ES13&#x27;,
       &#x27;ES21&#x27;, &#x27;ES22&#x27;, &#x27;ES23&#x27;, &#x27;ES24&#x27;, &#x27;ES30&#x27;, &#x27;ES41&#x27;, &#x27;ES42&#x27;, &#x27;ES43&#x27;, &#x27;ES51&#x27;,
       &#x27;ES52&#x27;, &#x27;ES53&#x27;, &#x27;ES61&#x27;, &#x27;ES62&#x27;, &#x27;ES63&#x27;, &#x27;ES64&#x27;, &#x27;ES70&#x27;, &#x27;FI1B&#x27;, &#x27;FI1C&#x27;,
       &#x27;FI1D&#x27;, &#x27;HR03&#x27;, &#x27;HR04&#x27;, &#x27;HU10&#x27;, &#x27;HU11&#x27;, &#x27;HU12&#x27;, &#x27;HU21&#x27;, &#x27;HU22&#x27;, &#x27;HU23&#x27;,
       &#x27;HU31&#x27;, &#x27;HU32&#x27;, &#x27;HU33&#x27;, &#x27;IE01&#x27;, &#x27;IE02&#x27;, &#x27;IE04&#x27;, &#x27;IE05&#x27;, &#x27;IE06&#x27;, &#x27;ITC1&#x27;,
       &#x27;ITC2&#x27;, &#x27;ITC3&#x27;, &#x27;ITC4&#x27;, &#x27;ITF1&#x27;, &#x27;ITF2&#x27;, &#x27;ITF3&#x27;, &#x27;ITF4&#x27;, &#x27;ITF5&#x27;, &#x27;ITF6&#x27;,
       &#x27;ITG1&#x27;, &#x27;ITG2&#x27;, &#x27;ITH1&#x27;, &#x27;ITH2&#x27;, &#x27;ITH3&#x27;, &#x27;ITH4&#x27;, &#x27;ITH5&#x27;, &#x27;ITI1&#x27;, &#x27;ITI2&#x27;,
       &#x27;ITI3&#x27;, &#x27;ITI4&#x27;, &#x27;LT01&#x27;, &#x27;LT02&#x27;, &#x27;NL11&#x27;, &#x27;NL12&#x27;, &#x27;NL13&#x27;, &#x27;NL21&#x27;, &#x27;NL22&#x27;,
       &#x27;NL23&#x27;, &#x27;NL31&#x27;, &#x27;NL32&#x27;, &#x27;NL33&#x27;, &#x27;NL34&#x27;, &#x27;NL41&#x27;, &#x27;NL42&#x27;, &#x27;NO01&#x27;, &#x27;NO02&#x27;,
       &#x27;NO03&#x27;, &#x27;NO04&#x27;, &#x27;NO05&#x27;, &#x27;NO06&#x27;, &#x27;NO07&#x27;, &#x27;PL21&#x27;, &#x27;PL22&#x27;, &#x27;PL41&#x27;, &#x27;PL42&#x27;,
       &#x27;PL43&#x27;, &#x27;PL51&#x27;, &#x27;PL52&#x27;, &#x27;PL61&#x27;, &#x27;PL62&#x27;, &#x27;PL63&#x27;, &#x27;PL71&#x27;, &#x27;PL72&#x27;, &#x27;PL81&#x27;,
       &#x27;PL82&#x27;, &#x27;PL84&#x27;, &#x27;PL91&#x27;, &#x27;PL92&#x27;, &#x27;PT11&#x27;, &#x27;PT15&#x27;, &#x27;PT16&#x27;, &#x27;PT17&#x27;, &#x27;PT18&#x27;,
       &#x27;PT20&#x27;, &#x27;PT30&#x27;, &#x27;RO11&#x27;, &#x27;RO12&#x27;, &#x27;RO21&#x27;, &#x27;RO22&#x27;, &#x27;RO31&#x27;, &#x27;RO32&#x27;, &#x27;RO41&#x27;,
       &#x27;RO42&#x27;, &#x27;SE11&#x27;, &#x27;SE12&#x27;, &#x27;SE21&#x27;, &#x27;SE22&#x27;, &#x27;SE23&#x27;, &#x27;SE31&#x27;, &#x27;SE32&#x27;, &#x27;SE33&#x27;,
       &#x27;SI01&#x27;, &#x27;SI02&#x27;, &#x27;SI03&#x27;, &#x27;SI04&#x27;, &#x27;SK01&#x27;, &#x27;SK02&#x27;, &#x27;SK03&#x27;, &#x27;SK04&#x27;],
      dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>2009 2010 2011 ... 2018 2019 2020</div><input id='attrs-bf77da31-1617-4704-933b-ed6ef6be28b3' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-bf77da31-1617-4704-933b-ed6ef6be28b3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e2578d56-40f1-460e-8d30-43b5c2ae8c93' class='xr-var-data-in' type='checkbox'><label for='data-e2578d56-40f1-460e-8d30-43b5c2ae8c93' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-bceb7383-8569-42c9-ba98-f61872db456b' class='xr-section-summary-in' type='checkbox'  checked><label for='section-bceb7383-8569-42c9-ba98-f61872db456b' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>percentage_material_deprivation</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... 10.0 9.6 8.3</div><input id='attrs-aa8ffff8-72dc-4df7-8d24-db3b2e367d17' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-aa8ffff8-72dc-4df7-8d24-db3b2e367d17' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ba10dca9-3012-417d-a9bf-54fc58b34dbe' class='xr-var-data-in' type='checkbox'><label for='data-ba10dca9-3012-417d-a9bf-54fc58b34dbe' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ nan,  nan,  nan, ..., 38.6, 38.5, 36.6],
       [ nan,  nan,  nan, ..., 40.4, 37.7, 35.1],
       [ nan,  nan,  nan, ..., 35.3, 34.9, 32.2],
       ...,
       [10.3,  9.8,  8.6, ...,  4.2,  5.6,  3.6],
       [11.1, 10.6, 10.7, ...,  9.1, 10.6,  8.1],
       [13.5, 15. , 12.3, ..., 10. ,  9.6,  8.3]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-ad5c6462-0485-4b8b-a7b5-86037f59a0ab' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-ad5c6462-0485-4b8b-a7b5-86037f59a0ab' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export

**** At-risk-of-poverty rate by NUTS 2 regions [TGS00103]

- link to the data: https://ec.europa.eu/eurostat/databrowser/view/tgs00103/default/table?lang=en


#+begin_src jupyter-python 
df = eurostat.get_data_df('tgs00103')
df.rename({'geo\\time':'nuts2'},inplace=True,axis=1)
df = df[(df.unit == "PC_POP")]
df.drop(["unit"],axis=1,inplace=True)
df['nuts'] = [len(x)-2 for x in df.nuts2]
df = df[df.nuts == 2]
df.drop('nuts',axis=1,inplace=True)

df = pd.melt(df,id_vars=['nuts2'],
                        value_vars=np.arange(2010,2022),
                        var_name='year',
             value_name='at risk of poverty')
df.set_index(['nuts2','year'],inplace=True)
df.head()
#+end_src

#+RESULTS:
#+begin_export html
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>at risk of poverty</th>
    </tr>
    <tr>
      <th>nuts2</th>
      <th>year</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AL01</th>
      <th>2010</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>AL02</th>
      <th>2010</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>AL03</th>
      <th>2010</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>BG31</th>
      <th>2010</th>
      <td>30.5</td>
    </tr>
    <tr>
      <th>BG32</th>
      <th>2010</th>
      <td>28.8</td>
    </tr>
  </tbody>
</table>
</div>
#+end_export


#+begin_src jupyter-python 
ds_at_risk_of_poverty = df.to_xarray()
ds_at_risk_of_poverty.to_netcdf("./data/at_risk_of_poverty_nuts_2.nc")
ds_at_risk_of_poverty
#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:             (nuts2: 173, year: 12)
Coordinates:
  * nuts2               (nuts2) object &#x27;AL01&#x27; &#x27;AL02&#x27; &#x27;AL03&#x27; ... &#x27;SK03&#x27; &#x27;SK04&#x27;
  * year                (year) int64 2010 2011 2012 2013 ... 2018 2019 2020 2021
Data variables:
    at risk of poverty  (nuts2, year) float64 nan nan nan nan ... 17.0 16.5 nan</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-3b841719-a99a-4f99-9f47-e816a323be74' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-3b841719-a99a-4f99-9f47-e816a323be74' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>nuts2</span>: 173</li><li><span class='xr-has-index'>year</span>: 12</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-1b2ce0c0-6dcd-4d6d-947c-5e1ba53bd8e4' class='xr-section-summary-in' type='checkbox'  checked><label for='section-1b2ce0c0-6dcd-4d6d-947c-5e1ba53bd8e4' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>nuts2</span></div><div class='xr-var-dims'>(nuts2)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;AL01&#x27; &#x27;AL02&#x27; ... &#x27;SK03&#x27; &#x27;SK04&#x27;</div><input id='attrs-6a67b206-2ef4-460f-8a16-d4709df942f0' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6a67b206-2ef4-460f-8a16-d4709df942f0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1271b3a6-3cd6-46c7-ae59-45f518dbe670' class='xr-var-data-in' type='checkbox'><label for='data-1271b3a6-3cd6-46c7-ae59-45f518dbe670' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AL01&#x27;, &#x27;AL02&#x27;, &#x27;AL03&#x27;, &#x27;BG31&#x27;, &#x27;BG32&#x27;, &#x27;BG33&#x27;, &#x27;BG34&#x27;, &#x27;BG41&#x27;, &#x27;BG42&#x27;,
       &#x27;CH01&#x27;, &#x27;CH02&#x27;, &#x27;CH03&#x27;, &#x27;CH04&#x27;, &#x27;CH05&#x27;, &#x27;CH06&#x27;, &#x27;CH07&#x27;, &#x27;CZ01&#x27;, &#x27;CZ02&#x27;,
       &#x27;CZ03&#x27;, &#x27;CZ04&#x27;, &#x27;CZ05&#x27;, &#x27;CZ06&#x27;, &#x27;CZ07&#x27;, &#x27;CZ08&#x27;, &#x27;DK01&#x27;, &#x27;DK02&#x27;, &#x27;DK03&#x27;,
       &#x27;DK04&#x27;, &#x27;DK05&#x27;, &#x27;EL30&#x27;, &#x27;EL41&#x27;, &#x27;EL42&#x27;, &#x27;EL43&#x27;, &#x27;EL51&#x27;, &#x27;EL52&#x27;, &#x27;EL53&#x27;,
       &#x27;EL54&#x27;, &#x27;EL61&#x27;, &#x27;EL62&#x27;, &#x27;EL63&#x27;, &#x27;EL64&#x27;, &#x27;EL65&#x27;, &#x27;ES11&#x27;, &#x27;ES12&#x27;, &#x27;ES13&#x27;,
       &#x27;ES21&#x27;, &#x27;ES22&#x27;, &#x27;ES23&#x27;, &#x27;ES24&#x27;, &#x27;ES30&#x27;, &#x27;ES41&#x27;, &#x27;ES42&#x27;, &#x27;ES43&#x27;, &#x27;ES51&#x27;,
       &#x27;ES52&#x27;, &#x27;ES53&#x27;, &#x27;ES61&#x27;, &#x27;ES62&#x27;, &#x27;ES63&#x27;, &#x27;ES64&#x27;, &#x27;ES70&#x27;, &#x27;FI1B&#x27;, &#x27;FI1C&#x27;,
       &#x27;FI1D&#x27;, &#x27;HR02&#x27;, &#x27;HR03&#x27;, &#x27;HR04&#x27;, &#x27;HR05&#x27;, &#x27;HR06&#x27;, &#x27;HU10&#x27;, &#x27;HU11&#x27;, &#x27;HU12&#x27;,
       &#x27;HU21&#x27;, &#x27;HU22&#x27;, &#x27;HU23&#x27;, &#x27;HU31&#x27;, &#x27;HU32&#x27;, &#x27;HU33&#x27;, &#x27;IE01&#x27;, &#x27;IE02&#x27;, &#x27;IE04&#x27;,
       &#x27;IE05&#x27;, &#x27;IE06&#x27;, &#x27;ITC1&#x27;, &#x27;ITC2&#x27;, &#x27;ITC3&#x27;, &#x27;ITC4&#x27;, &#x27;ITF1&#x27;, &#x27;ITF2&#x27;, &#x27;ITF3&#x27;,
       &#x27;ITF4&#x27;, &#x27;ITF5&#x27;, &#x27;ITF6&#x27;, &#x27;ITG1&#x27;, &#x27;ITG2&#x27;, &#x27;ITH1&#x27;, &#x27;ITH2&#x27;, &#x27;ITH3&#x27;, &#x27;ITH4&#x27;,
       &#x27;ITH5&#x27;, &#x27;ITI1&#x27;, &#x27;ITI2&#x27;, &#x27;ITI3&#x27;, &#x27;ITI4&#x27;, &#x27;LT01&#x27;, &#x27;LT02&#x27;, &#x27;NL11&#x27;, &#x27;NL12&#x27;,
       &#x27;NL13&#x27;, &#x27;NL21&#x27;, &#x27;NL22&#x27;, &#x27;NL23&#x27;, &#x27;NL31&#x27;, &#x27;NL32&#x27;, &#x27;NL33&#x27;, &#x27;NL34&#x27;, &#x27;NL41&#x27;,
       &#x27;NL42&#x27;, &#x27;NO01&#x27;, &#x27;NO02&#x27;, &#x27;NO03&#x27;, &#x27;NO04&#x27;, &#x27;NO05&#x27;, &#x27;NO06&#x27;, &#x27;NO07&#x27;, &#x27;PL21&#x27;,
       &#x27;PL22&#x27;, &#x27;PL41&#x27;, &#x27;PL42&#x27;, &#x27;PL43&#x27;, &#x27;PL51&#x27;, &#x27;PL52&#x27;, &#x27;PL61&#x27;, &#x27;PL62&#x27;, &#x27;PL63&#x27;,
       &#x27;PL71&#x27;, &#x27;PL72&#x27;, &#x27;PL81&#x27;, &#x27;PL82&#x27;, &#x27;PL84&#x27;, &#x27;PL91&#x27;, &#x27;PL92&#x27;, &#x27;PT11&#x27;, &#x27;PT15&#x27;,
       &#x27;PT16&#x27;, &#x27;PT17&#x27;, &#x27;PT18&#x27;, &#x27;PT20&#x27;, &#x27;PT30&#x27;, &#x27;RO11&#x27;, &#x27;RO12&#x27;, &#x27;RO21&#x27;, &#x27;RO22&#x27;,
       &#x27;RO31&#x27;, &#x27;RO32&#x27;, &#x27;RO41&#x27;, &#x27;RO42&#x27;, &#x27;SE11&#x27;, &#x27;SE12&#x27;, &#x27;SE21&#x27;, &#x27;SE22&#x27;, &#x27;SE23&#x27;,
       &#x27;SE31&#x27;, &#x27;SE32&#x27;, &#x27;SE33&#x27;, &#x27;SI01&#x27;, &#x27;SI02&#x27;, &#x27;SI03&#x27;, &#x27;SI04&#x27;, &#x27;SK01&#x27;, &#x27;SK02&#x27;,
       &#x27;SK03&#x27;, &#x27;SK04&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>2010 2011 2012 ... 2019 2020 2021</div><input id='attrs-462f4ad8-99d7-4427-9684-d87d82b68f92' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-462f4ad8-99d7-4427-9684-d87d82b68f92' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d0cab462-4f7e-4b50-9c9d-ecb114ab8429' class='xr-var-data-in' type='checkbox'><label for='data-d0cab462-4f7e-4b50-9c9d-ecb114ab8429' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-f66dda71-5615-4a8f-9449-bfd325bf6fb1' class='xr-section-summary-in' type='checkbox'  checked><label for='section-f66dda71-5615-4a8f-9449-bfd325bf6fb1' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>at risk of poverty</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... 17.0 16.5 nan</div><input id='attrs-b5374d32-0a2d-4639-938f-d6e92e85164e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b5374d32-0a2d-4639-938f-d6e92e85164e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7c88e8b0-989e-4d39-a189-a3dc90499e25' class='xr-var-data-in' type='checkbox'><label for='data-7c88e8b0-989e-4d39-a189-a3dc90499e25' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ nan,  nan,  nan, ..., 25.9, 25.1,  nan],
       [ nan,  nan,  nan, ..., 22.7, 21.3,  nan],
       [ nan,  nan,  nan, ..., 20.8, 19.5,  nan],
       ...,
       [10.3, 11.4, 11.9, ...,  7.4,  7.1,  nan],
       [13.1, 13.1, 14.1, ..., 15.6, 14.8,  nan],
       [15.8, 16.9, 16.7, ..., 17. , 16.5,  nan]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-bfb5c5ca-e29c-4617-ab74-112fbf771599' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-bfb5c5ca-e29c-4617-ab74-112fbf771599' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export

*** unmet needs



Self-reported unmet needs for medical examination by main reason declared and NUTS 2 regions

- link to the data: https://ec.europa.eu/eurostat/databrowser/view/hlth_silc_08_r/default/table?lang=en
- https://ec.europa.eu/eurostat/documents/1012329/6070906/Personal+data+-+health+PH.pdf/7edfec40-462a-4cb2-a5fc-8d8845000ca4

| value    |                                                         |
|----------+---------------------------------------------------------|
| TOOEXP   | Too expensive                                           |
| TOOFAR   | Too far to travel                                       |
| TOOEFW   | Too expensive or too far to travel or waiting list      |
| NOTIME   | No time                                                 |
| NO_UNMET | No unmet needs to declare                               |
| NOKNOW   | Didn't know any good doctor or specialist               |
| WAITING  | Waiting list                                            |
| FEAR     | Fear of doctor, hospital, examination or treatment      |
| HOPING   | Wanted to wait and see if problem got better on its own |
| OTH      | Other                                                   |

We drop the values =NO_UNMET= and =OTH=. The former is dropped because we are interested in unmet medical needs. The latter because the reason is unclear. 


#+begin_src jupyter-python 
df = eurostat.get_data_df('hlth_silc_08_r')
df.rename({'geo\\time':'nuts2'},inplace=True,axis=1)
df.drop(["unit"],axis=1,inplace=True)
df['nuts'] = [len(x)-2 for x in df.nuts2]
df = df[df.nuts == 2]
df.drop('nuts',axis=1,inplace=True)
columns = ['FEAR','TOOEXP','TOOFAR','WAITING',\
           'HOPING', 'NOTIME', 'NOKNOW']
df=df[df.reason.isin(columns)]
df = pd.melt(df,id_vars=['nuts2','reason'],
                        value_vars=np.arange(2009,2021),
                        var_name='year',\
             value_name='unmet needs')
df.set_index(['nuts2','year','reason'],inplace=True)

df = df.unstack()
df.columns = df.columns.droplevel()
df['UNMET'] = df[columns].sum(axis=1)
df.drop(['FEAR','TOOFAR','WAITING',\
           'HOPING', 'NOTIME', 'NOKNOW'],axis=1,inplace=True)
df.tail()
#+end_src

#+RESULTS:
#+begin_export html
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>reason</th>
      <th>TOOEXP</th>
      <th>UNMET</th>
    </tr>
    <tr>
      <th>nuts2</th>
      <th>year</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">SK04</th>
      <th>2016</th>
      <td>0.5</td>
      <td>7.4</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>0.2</td>
      <td>5.5</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>0.4</td>
      <td>6.2</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>0.4</td>
      <td>6.6</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>0.2</td>
      <td>6.0</td>
    </tr>
  </tbody>
</table>
</div>
#+end_export


#+begin_src jupyter-python 
ds_unmet_needs = df.to_xarray()
ds_unmet_needs.to_netcdf("./data/unmet_needs_nuts_2.nc")
ds_unmet_needs
#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:  (nuts2: 106, year: 12)
Coordinates:
  * nuts2    (nuts2) object &#x27;AL01&#x27; &#x27;AL02&#x27; &#x27;AL03&#x27; &#x27;BG31&#x27; ... &#x27;SK02&#x27; &#x27;SK03&#x27; &#x27;SK04&#x27;
  * year     (year) int64 2009 2010 2011 2012 2013 ... 2016 2017 2018 2019 2020
Data variables:
    TOOEXP   (nuts2, year) float64 nan nan nan nan nan ... 0.5 0.2 0.4 0.4 0.2
    UNMET    (nuts2, year) float64 0.0 0.0 0.0 0.0 0.0 ... 7.4 5.5 6.2 6.6 6.0</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-4d3c5701-6df3-426f-9c98-919ac3aafeba' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-4d3c5701-6df3-426f-9c98-919ac3aafeba' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>nuts2</span>: 106</li><li><span class='xr-has-index'>year</span>: 12</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-da190636-6545-4523-a5d0-6a99749dbbbd' class='xr-section-summary-in' type='checkbox'  checked><label for='section-da190636-6545-4523-a5d0-6a99749dbbbd' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>nuts2</span></div><div class='xr-var-dims'>(nuts2)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;AL01&#x27; &#x27;AL02&#x27; ... &#x27;SK03&#x27; &#x27;SK04&#x27;</div><input id='attrs-43b108df-3a7b-458b-a033-630ae2c730e4' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-43b108df-3a7b-458b-a033-630ae2c730e4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-530c4b14-17d5-4a39-a805-b6e8edb239d1' class='xr-var-data-in' type='checkbox'><label for='data-530c4b14-17d5-4a39-a805-b6e8edb239d1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AL01&#x27;, &#x27;AL02&#x27;, &#x27;AL03&#x27;, &#x27;BG31&#x27;, &#x27;BG32&#x27;, &#x27;BG33&#x27;, &#x27;BG34&#x27;, &#x27;BG41&#x27;, &#x27;BG42&#x27;,
       &#x27;CH01&#x27;, &#x27;CH02&#x27;, &#x27;CH03&#x27;, &#x27;CH04&#x27;, &#x27;CH05&#x27;, &#x27;CH06&#x27;, &#x27;CH07&#x27;, &#x27;DK01&#x27;, &#x27;DK02&#x27;,
       &#x27;DK03&#x27;, &#x27;DK04&#x27;, &#x27;DK05&#x27;, &#x27;EL30&#x27;, &#x27;EL41&#x27;, &#x27;EL42&#x27;, &#x27;EL43&#x27;, &#x27;EL51&#x27;, &#x27;EL52&#x27;,
       &#x27;EL53&#x27;, &#x27;EL54&#x27;, &#x27;EL61&#x27;, &#x27;EL62&#x27;, &#x27;EL63&#x27;, &#x27;EL64&#x27;, &#x27;EL65&#x27;, &#x27;FI1B&#x27;, &#x27;FI1C&#x27;,
       &#x27;FI1D&#x27;, &#x27;HR02&#x27;, &#x27;HR03&#x27;, &#x27;HR04&#x27;, &#x27;HR05&#x27;, &#x27;HR06&#x27;, &#x27;HU10&#x27;, &#x27;HU11&#x27;, &#x27;HU12&#x27;,
       &#x27;HU21&#x27;, &#x27;HU22&#x27;, &#x27;HU23&#x27;, &#x27;HU31&#x27;, &#x27;HU32&#x27;, &#x27;HU33&#x27;, &#x27;IE01&#x27;, &#x27;IE02&#x27;, &#x27;IE04&#x27;,
       &#x27;IE05&#x27;, &#x27;IE06&#x27;, &#x27;LT01&#x27;, &#x27;LT02&#x27;, &#x27;NO01&#x27;, &#x27;NO02&#x27;, &#x27;NO03&#x27;, &#x27;NO04&#x27;, &#x27;NO05&#x27;,
       &#x27;NO06&#x27;, &#x27;NO07&#x27;, &#x27;PL21&#x27;, &#x27;PL22&#x27;, &#x27;PL41&#x27;, &#x27;PL42&#x27;, &#x27;PL43&#x27;, &#x27;PL51&#x27;, &#x27;PL52&#x27;,
       &#x27;PL61&#x27;, &#x27;PL62&#x27;, &#x27;PL63&#x27;, &#x27;PL71&#x27;, &#x27;PL72&#x27;, &#x27;PL81&#x27;, &#x27;PL82&#x27;, &#x27;PL84&#x27;, &#x27;PL91&#x27;,
       &#x27;PL92&#x27;, &#x27;RO11&#x27;, &#x27;RO12&#x27;, &#x27;RO21&#x27;, &#x27;RO22&#x27;, &#x27;RO31&#x27;, &#x27;RO32&#x27;, &#x27;RO41&#x27;, &#x27;RO42&#x27;,
       &#x27;SE11&#x27;, &#x27;SE12&#x27;, &#x27;SE21&#x27;, &#x27;SE22&#x27;, &#x27;SE23&#x27;, &#x27;SE31&#x27;, &#x27;SE32&#x27;, &#x27;SE33&#x27;, &#x27;SI01&#x27;,
       &#x27;SI02&#x27;, &#x27;SI03&#x27;, &#x27;SI04&#x27;, &#x27;SK01&#x27;, &#x27;SK02&#x27;, &#x27;SK03&#x27;, &#x27;SK04&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>2009 2010 2011 ... 2018 2019 2020</div><input id='attrs-aa5d02e9-a69f-454d-a425-4516b764d4eb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-aa5d02e9-a69f-454d-a425-4516b764d4eb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-435c5da4-1985-456e-adf1-2b32ebc21c96' class='xr-var-data-in' type='checkbox'><label for='data-435c5da4-1985-456e-adf1-2b32ebc21c96' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-acb009c3-7872-40f2-a438-3603c7a8a174' class='xr-section-summary-in' type='checkbox'  checked><label for='section-acb009c3-7872-40f2-a438-3603c7a8a174' class='xr-section-summary' >Data variables: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>TOOEXP</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... 0.2 0.4 0.4 0.2</div><input id='attrs-f5ad9275-6dbb-4c2d-9950-9fe7b96bf841' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f5ad9275-6dbb-4c2d-9950-9fe7b96bf841' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-51d06be8-a72c-4f37-b8d2-0488d2899f89' class='xr-var-data-in' type='checkbox'><label for='data-51d06be8-a72c-4f37-b8d2-0488d2899f89' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ nan,  nan,  nan, ..., 18.9, 21.8, 12. ],
       [ nan,  nan,  nan, ..., 12.3,  9.3,  7.6],
       [ nan,  nan,  nan, ..., 10.8, 11.6,  8.5],
       ...,
       [ 0.6,  0.8,  1. , ...,  0.4,  0.4,  0.7],
       [ 0.6,  0.6,  0.5, ...,  1.1,  1.1,  1.6],
       [ 0.7,  0.8,  0.8, ...,  0.4,  0.4,  0.2]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>UNMET</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.0 0.0 0.0 0.0 ... 5.5 6.2 6.6 6.0</div><input id='attrs-825c4cd9-66cf-4143-a1dc-f2a9f3f2cbcf' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-825c4cd9-66cf-4143-a1dc-f2a9f3f2cbcf' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-577e302f-e75f-45c6-808c-0cff5d50aa1b' class='xr-var-data-in' type='checkbox'><label for='data-577e302f-e75f-45c6-808c-0cff5d50aa1b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ 0. ,  0. ,  0. , ..., 26.1, 26.9, 19.8],
       [ 0. ,  0. ,  0. , ..., 20.6, 15. , 11.1],
       [ 0. ,  0. ,  0. , ..., 17.5, 24.4, 13.6],
       ...,
       [ 5.2,  5.7,  5.6, ...,  4. ,  3.7,  3. ],
       [ 3.6,  4.9,  4.6, ...,  9.9,  9.3, 13.5],
       [ 3.5,  4.4,  5.2, ...,  6.2,  6.6,  6. ]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-b77cda2b-b737-4f74-a6b5-1d2f2799a80a' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-b77cda2b-b737-4f74-a6b5-1d2f2799a80a' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export


*** unemployment
- https://ec.europa.eu/eurostat/databrowser/view/LFST_R_LFU3RT/default/table?lang=en


#+begin_src jupyter-python :display plain
df = eurostat.get_data_df('lfst_r_lfu3rt')
df.rename({'geo\\time':'nuts2'},inplace=True,axis=1)
df.drop(["unit"],axis=1,inplace=True)
df['nuts'] = [len(x)-2 for x in df.nuts2]
df = df[df.nuts == 2]
df.drop('nuts',axis=1,inplace=True)
df=df[(df.age.isin(['Y15-74'])) & (df.isced11.isin(['TOTAL']))
      & (df.sex == 'T') ]
df.drop(['isced11','sex','age'],inplace=True,axis=1)
df = pd.melt(df,id_vars=['nuts2'],
                        value_vars=np.arange(2009,2023),
                        var_name='year',\
             value_name='unemployment')
df.set_index(['nuts2','year'],inplace=True)

# df = df.unstack()
# df.columns = df.columns.droplevel()
# df['UNMET'] = df[columns].sum(axis=1)
# df.drop(['FEAR','TOOFAR','WAITING',\
#            'HOPING', 'NOTIME', 'NOKNOW'],axis=1,inplace=True)
df.head()
#+end_src

#+RESULTS:
:             unemployment
: nuts2 year              
: AT11  2009           5.0
: AT12  2009           4.7
: AT13  2009           8.8
: AT21  2009           4.6
: AT22  2009           5.0


#+begin_src jupyter-python 
ds_unemployment = df.to_xarray()
ds_unemployment.to_netcdf("./data/unemployment_nuts_2.nc")
ds_unemployment
#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:       (nuts2: 345, year: 14)
Coordinates:
  * nuts2         (nuts2) object &#x27;AT11&#x27; &#x27;AT12&#x27; &#x27;AT13&#x27; ... &#x27;UKM8&#x27; &#x27;UKM9&#x27; &#x27;UKN0&#x27;
  * year          (year) int64 2009 2010 2011 2012 2013 ... 2019 2020 2021 2022
Data variables:
    unemployment  (nuts2, year) float64 5.0 4.0 3.8 4.6 4.3 ... 2.7 nan nan nan</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-7caad4ca-79ca-4d6d-b98c-653c19622ef8' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-7caad4ca-79ca-4d6d-b98c-653c19622ef8' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>nuts2</span>: 345</li><li><span class='xr-has-index'>year</span>: 14</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-1882e780-6da3-48ea-a157-6df65f44dcb1' class='xr-section-summary-in' type='checkbox'  checked><label for='section-1882e780-6da3-48ea-a157-6df65f44dcb1' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>nuts2</span></div><div class='xr-var-dims'>(nuts2)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;AT11&#x27; &#x27;AT12&#x27; ... &#x27;UKM9&#x27; &#x27;UKN0&#x27;</div><input id='attrs-41ee4437-2057-42c5-ac22-df943d07ef70' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-41ee4437-2057-42c5-ac22-df943d07ef70' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-acfdfc0d-70cf-48eb-bed6-ab3e01376761' class='xr-var-data-in' type='checkbox'><label for='data-acfdfc0d-70cf-48eb-bed6-ab3e01376761' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AT11&#x27;, &#x27;AT12&#x27;, &#x27;AT13&#x27;, ..., &#x27;UKM8&#x27;, &#x27;UKM9&#x27;, &#x27;UKN0&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>2009 2010 2011 ... 2020 2021 2022</div><input id='attrs-436a1bca-fb82-43f1-a7d0-619e62c46e96' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-436a1bca-fb82-43f1-a7d0-619e62c46e96' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d68bd42c-a1fc-424c-b8ca-9eddabaa9196' class='xr-var-data-in' type='checkbox'><label for='data-d68bd42c-a1fc-424c-b8ca-9eddabaa9196' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020,
       2021, 2022])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-60caad75-7645-40ce-83b1-113d5fa492bc' class='xr-section-summary-in' type='checkbox'  checked><label for='section-60caad75-7645-40ce-83b1-113d5fa492bc' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>unemployment</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>5.0 4.0 3.8 4.6 ... 2.7 nan nan nan</div><input id='attrs-b01451b6-794b-4fb0-b906-dd3f2d3c15d1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b01451b6-794b-4fb0-b906-dd3f2d3c15d1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bc8f03e8-510b-4048-93db-811208e45a04' class='xr-var-data-in' type='checkbox'><label for='data-bc8f03e8-510b-4048-93db-811208e45a04' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ 5. ,  4. ,  3.8, ...,  4.2,  5.1,  4.3],
       [ 4.7,  3.9,  4.5, ...,  4.2,  5.1,  4. ],
       [ 8.8,  8.3,  8.1, ..., 10.7, 12.1,  9.2],
       ...,
       [ nan,  nan,  nan, ...,  nan,  nan,  nan],
       [ nan,  nan,  nan, ...,  nan,  nan,  nan],
       [ 6.4,  7.1,  7.2, ...,  nan,  nan,  nan]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-d4721d34-432c-4526-bca7-e87017e0af65' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-d4721d34-432c-4526-bca7-e87017e0af65' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export

*** gdp per head
- https://ec.europa.eu/eurostat/databrowser/view/tgs00005/default/map?lang=en
  
Purchasing power standard (PPS, EU27 from 2020), per inhabitant

GDP (gross domestic product) is an indicator of the output of a country or a region. It reflects the total value of all goods and services produced less the value of goods and services used for intermediate consumption in their production. Expressing GDP in PPS (purchasing power standards) eliminates differences in price levels between countries.


#+begin_src jupyter-python :display plain
df = eurostat.get_data_df('tgs00005')
df.rename({'geo\\time':'nuts2'},inplace=True,axis=1)
df.drop(["unit"],axis=1,inplace=True)
df['nuts'] = [len(x)-2 for x in df.nuts2]
df = df[df.nuts == 2]
df.drop('nuts',axis=1,inplace=True)
# df=df[(df.age.isin(['Y15-74'])) & (df.isced11.isin(['TOTAL']))
#       & (df.sex == 'T') ]
# df.drop(['isced11','sex','age'],inplace=True,axis=1)
df = pd.melt(df,id_vars=['nuts2'],
                        value_vars=np.arange(2010,2022),
                        var_name='year',\
             value_name='gdp_per_capita')
df.set_index(['nuts2','year'],inplace=True)

# df = df.unstack()
# df.columns = df.columns.droplevel()
# df['UNMET'] = df[columns].sum(axis=1)
# df.drop(['FEAR','TOOFAR','WAITING',\
#            'HOPING', 'NOTIME', 'NOKNOW'],axis=1,inplace=True)
df.head()
#+end_src

#+RESULTS:
:             gdp_per_capita
: nuts2 year                
: AL01  2010          6000.0
: AL02  2010          9300.0
: AL03  2010          6200.0
: AT11  2010         21200.0
: AT12  2010         25900.0


#+begin_src jupyter-python 
ds_gdp_per_capita = df.to_xarray()
ds_gdp_per_capita.to_netcdf("./data/gdp_per_capita_nuts_2.nc")
ds_gdp_per_capita
#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:         (nuts2: 290, year: 12)
Coordinates:
  * nuts2           (nuts2) object &#x27;AL01&#x27; &#x27;AL02&#x27; &#x27;AL03&#x27; ... &#x27;TRC1&#x27; &#x27;TRC2&#x27; &#x27;TRC3&#x27;
  * year            (year) int64 2010 2011 2012 2013 ... 2018 2019 2020 2021
Data variables:
    gdp_per_capita  (nuts2, year) float64 6e+03 6.1e+03 ... 9.6e+03 1.03e+04</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-03b2b643-0dd4-43ab-8b4f-256d28703a0b' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-03b2b643-0dd4-43ab-8b4f-256d28703a0b' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>nuts2</span>: 290</li><li><span class='xr-has-index'>year</span>: 12</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-15790f39-591a-45a7-a092-b8bd9a55a03d' class='xr-section-summary-in' type='checkbox'  checked><label for='section-15790f39-591a-45a7-a092-b8bd9a55a03d' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>nuts2</span></div><div class='xr-var-dims'>(nuts2)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;AL01&#x27; &#x27;AL02&#x27; ... &#x27;TRC2&#x27; &#x27;TRC3&#x27;</div><input id='attrs-a8b7a112-ad3b-4fb4-9a94-c125b4cbeb5f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a8b7a112-ad3b-4fb4-9a94-c125b4cbeb5f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-43b800bd-b991-4042-87c2-e1c903849701' class='xr-var-data-in' type='checkbox'><label for='data-43b800bd-b991-4042-87c2-e1c903849701' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AL01&#x27;, &#x27;AL02&#x27;, &#x27;AL03&#x27;, ..., &#x27;TRC1&#x27;, &#x27;TRC2&#x27;, &#x27;TRC3&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>2010 2011 2012 ... 2019 2020 2021</div><input id='attrs-fd05edfb-455c-4884-b11e-13ba785e0a1e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-fd05edfb-455c-4884-b11e-13ba785e0a1e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7159f6ea-c2cc-4392-bb67-ebf5f4a3c718' class='xr-var-data-in' type='checkbox'><label for='data-7159f6ea-c2cc-4392-bb67-ebf5f4a3c718' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-7714e154-1819-46f2-9ad0-3df5584b4510' class='xr-section-summary-in' type='checkbox'  checked><label for='section-7714e154-1819-46f2-9ad0-3df5584b4510' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>gdp_per_capita</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>6e+03 6.1e+03 ... 9.6e+03 1.03e+04</div><input id='attrs-2207e30f-2e50-4e0d-a725-b84476413201' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2207e30f-2e50-4e0d-a725-b84476413201' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-915f7126-6868-4bd9-95a2-a9c2c75ae34d' class='xr-var-data-in' type='checkbox'><label for='data-915f7126-6868-4bd9-95a2-a9c2c75ae34d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ 6000.,  6100.,  6300., ...,  7700.,  7400.,    nan],
       [ 9300.,  9300.,  9300., ..., 11400., 11000.,    nan],
       [ 6200.,  7100.,  7400., ...,  8600.,  8400.,    nan],
       ...,
       [ 7300.,  8300.,  9100., ..., 12000., 12800., 14600.],
       [ 5900.,  6400.,  6600., ...,  7200.,  7100.,  7200.],
       [ 6400.,  7000.,  7300., ...,  9500.,  9600., 10300.]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-0f805d33-2a01-4119-8f9b-ae8104489745' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-0f805d33-2a01-4119-8f9b-ae8104489745' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export




*** infant mortality
- https://ec.europa.eu/eurostat/databrowser/view/DEMO_R_MINFIND/default/table?lang=en&category=demo.demomreg
- https://ec.europa.eu/health/indicators/docs/echi_11.pdf
- The number of deaths of infants (younger than one year of age at death) per 1000 live births (based on one year data).


#+begin_src jupyter-python :display plain
df = eurostat.get_data_df('demo_r_minfind')
df.rename({'geo\\time':'nuts2'},inplace=True,axis=1)
df.drop(["unit"],axis=1,inplace=True)
df['nuts'] = [len(x)-2 for x in df.nuts2]
df = df[df.nuts == 2]
df.drop('nuts',axis=1,inplace=True)
df = pd.melt(df,id_vars=['nuts2'],
                        value_vars=np.arange(2009,2022),
                        var_name='year',\
             value_name='infant mortality')
df.set_index(['nuts2','year'],inplace=True)

# df = df.unstack()
# df.columns = df.columns.droplevel()
# df['UNMET'] = df[columns].sum(axis=1)
# df.drop(['FEAR','TOOFAR','WAITING',\
#            'HOPING', 'NOTIME', 'NOKNOW'],axis=1,inplace=True)
df.head()
#+end_src

#+RESULTS:
:             infant mortality
: nuts2 year                  
: AL01  2009               NaN
: AL02  2009               NaN
: AL03  2009               NaN
: AT11  2009               0.9
: AT12  2009               4.2


#+begin_src jupyter-python 
ds_infant_mortality = df.to_xarray()
ds_infant_mortality.to_netcdf("./data/infant_mortality_nuts_2.nc")
ds_infant_mortality
#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:           (nuts2: 340, year: 13)
Coordinates:
  * nuts2             (nuts2) object &#x27;AL01&#x27; &#x27;AL02&#x27; &#x27;AL03&#x27; ... &#x27;UKM9&#x27; &#x27;UKN0&#x27;
  * year              (year) int64 2009 2010 2011 2012 ... 2018 2019 2020 2021
Data variables:
    infant mortality  (nuts2, year) float64 nan nan nan nan ... 4.2 nan nan nan</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-a27fc4b8-d408-42e6-a043-e3801ac56850' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-a27fc4b8-d408-42e6-a043-e3801ac56850' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>nuts2</span>: 340</li><li><span class='xr-has-index'>year</span>: 13</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-dc767e30-012d-4b79-81bb-503aae0df112' class='xr-section-summary-in' type='checkbox'  checked><label for='section-dc767e30-012d-4b79-81bb-503aae0df112' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>nuts2</span></div><div class='xr-var-dims'>(nuts2)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;AL01&#x27; &#x27;AL02&#x27; ... &#x27;UKM9&#x27; &#x27;UKN0&#x27;</div><input id='attrs-b3099702-5a40-434c-9ee5-cf0160fcae63' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-b3099702-5a40-434c-9ee5-cf0160fcae63' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-12ba676d-475c-4e08-9617-ef212076b1d3' class='xr-var-data-in' type='checkbox'><label for='data-12ba676d-475c-4e08-9617-ef212076b1d3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AL01&#x27;, &#x27;AL02&#x27;, &#x27;AL03&#x27;, ..., &#x27;UKM8&#x27;, &#x27;UKM9&#x27;, &#x27;UKN0&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>2009 2010 2011 ... 2019 2020 2021</div><input id='attrs-0966fc7a-65d9-4473-9034-44b370806a06' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0966fc7a-65d9-4473-9034-44b370806a06' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9a0f906b-12ab-4aaf-b463-4c9e353f0450' class='xr-var-data-in' type='checkbox'><label for='data-9a0f906b-12ab-4aaf-b463-4c9e353f0450' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020,
       2021])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-9c7a7b49-dc1c-4e56-a846-77c792b37131' class='xr-section-summary-in' type='checkbox'  checked><label for='section-9c7a7b49-dc1c-4e56-a846-77c792b37131' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>infant mortality</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... 4.2 nan nan nan</div><input id='attrs-e6c7729e-8191-4cae-a3ec-238b79a95299' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e6c7729e-8191-4cae-a3ec-238b79a95299' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-76dee85b-3a86-4aa4-b5f1-232b32a4d90e' class='xr-var-data-in' type='checkbox'><label for='data-76dee85b-3a86-4aa4-b5f1-232b32a4d90e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ nan,  nan,  nan, ..., 11.1,  9. ,  nan],
       [ nan,  nan,  nan, ..., 10.6, 11.3,  nan],
       [ nan,  nan,  nan, ...,  8.2,  9.2,  nan],
       ...,
       [ nan,  nan,  nan, ...,  nan,  nan,  nan],
       [ nan,  nan,  nan, ...,  nan,  nan,  nan],
       [ 4.8,  5.4,  3.9, ...,  nan,  nan,  nan]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-9d790250-6d8d-43d4-9b95-67c805311982' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-9d790250-6d8d-43d4-9b95-67c805311982' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export


*** Cooling and heating degree days
- https://ec.europa.eu/eurostat/databrowser/view/NRG_CHDDR2_A/default/table?lang=en
- https://ec.europa.eu/eurostat/cache/metadata/en/nrg_chdd_esms.htm
-  https://www.thelancet.com/journals/lanplh/article/PIIS2542-5196(23)00023-2/fulltext


From the description [[https://ec.europa.eu/eurostat/cache/metadata/en/nrg_chdd_esms.htm][here]]:
*Heating Degree Days (HDD) index*: the severity of the cold in a specific time period taking into consideration outdoor temperature and average room temperature (in other words the need for heating). The calculation of HDD relies on the base temperature, defined as the lowest daily mean air temperature not leading to indoor heating. The value of the base temperature depends in principle on several factors associated with the building and the surrounding environment. By using a general climatological approach, the base temperature is set to a constant value of 15°C in the HDD calculation. 

=If= $T_m \le 15°C$ =Then= $HDD = \sum_i(18°C - T_i^m)$ =Else= $HDD = 0$ where $T_i^m$ is the mean air temperature of day $i$.

Examples: If the daily mean air temperature is 12°C, for that day the value of the HDD index is 6 (18°C-12°C). If the daily mean air temperature is 16°C, for that day the HDD index is 0.

*Cooling degree days (CDD) index*:  the severity of the heat in a specific time period taking into consideration outdoor temperature and average room temperature (in other words the need for cooling). The calculation of CDD relies on the base temperature, defined as the highest daily mean air temperature not leading to indoor cooling. The value of the base temperature depends in principle on several factors associated with the building and the surrounding environment. By using a general climatological approach, the base temperature is set to a constant value of 24°C in the CDD calculation.

=If= $T_m \ge 24°C$ =Then= $CDD = \sum_{i} (T_i^m - 21°C)$ =Else= $CDD = 0$ where $T_i^m$ is the mean air temperature of day $i$.

Examples: If the daily mean air temperature is 26°C, for that day the value of the CDD index is 5 (26°C-21°C). If the daily mean air temperature is 22°C, for that day the CDD index is 0.

#+begin_src jupyter-python :display plain
df = eurostat.get_data_df('nrg_chddr2_a')
df.rename({'geo\\time':'nuts2'},inplace=True,axis=1)
df.drop(["unit"],axis=1,inplace=True)
df['nuts'] = [len(x)-2 for x in df.nuts2]
df = df[df.nuts == 2]
df.drop('nuts',axis=1,inplace=True)
df = pd.melt(df,id_vars=['nuts2','indic_nrg'],
                        value_vars=np.arange(2009,2023),
                        var_name='year',\
             value_name='degree days')
df.set_index(['nuts2','year','indic_nrg'],inplace=True)

df = df.unstack()
df.columns = df.columns.droplevel()
df.reset_index(inplace=True)
df.columns = [' '.join(col).strip() for col in df.columns.values]
df.rename({'n u t s 2':'nuts2','y e a r': 'year', 'C D D':'CDD', 'H D D':'HDD'},inplace=True,axis=1)
df.set_index(['nuts2','year'],inplace=True)
df.head()
#+end_src

#+RESULTS:
:                CDD      HDD
: nuts2 year                 
: AT11  2009   41.91  2698.22
:       2010   68.42  3102.17
:       2011   53.31  2795.37
:       2012  118.50  2731.69
:       2013  123.26  2842.43


#+begin_src jupyter-python 
ds_heating_cooling_days = df.to_xarray()
ds_heating_cooling_days.to_netcdf("./data/heating_cooling_days_nuts_2.nc")
ds_heating_cooling_days
#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:  (nuts2: 241, year: 14)
Coordinates:
  * nuts2    (nuts2) object &#x27;AT11&#x27; &#x27;AT12&#x27; &#x27;AT13&#x27; &#x27;AT21&#x27; ... &#x27;SK02&#x27; &#x27;SK03&#x27; &#x27;SK04&#x27;
  * year     (year) int64 2009 2010 2011 2012 2013 ... 2018 2019 2020 2021 2022
Data variables:
    CDD      (nuts2, year) float64 41.91 68.42 53.31 118.5 ... 9.41 51.69 52.53
    HDD      (nuts2, year) float64 2.698e+03 3.102e+03 ... 3.549e+03 3.226e+03</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-3e0c169b-fac0-40cf-aefb-6f272397b051' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-3e0c169b-fac0-40cf-aefb-6f272397b051' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>nuts2</span>: 241</li><li><span class='xr-has-index'>year</span>: 14</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-7dc11f15-8cdc-49b0-baa0-0b621faff507' class='xr-section-summary-in' type='checkbox'  checked><label for='section-7dc11f15-8cdc-49b0-baa0-0b621faff507' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>nuts2</span></div><div class='xr-var-dims'>(nuts2)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;AT11&#x27; &#x27;AT12&#x27; ... &#x27;SK03&#x27; &#x27;SK04&#x27;</div><input id='attrs-d82664c2-b3cb-4fa6-801a-33c69ce8e17f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d82664c2-b3cb-4fa6-801a-33c69ce8e17f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fe8f6be0-7843-4b99-86aa-2631a415dc6a' class='xr-var-data-in' type='checkbox'><label for='data-fe8f6be0-7843-4b99-86aa-2631a415dc6a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AT11&#x27;, &#x27;AT12&#x27;, &#x27;AT13&#x27;, ..., &#x27;SK02&#x27;, &#x27;SK03&#x27;, &#x27;SK04&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>2009 2010 2011 ... 2020 2021 2022</div><input id='attrs-92863ee9-a48c-47f7-80c1-7e22b49fc31f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-92863ee9-a48c-47f7-80c1-7e22b49fc31f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ee1b90b9-db7a-4929-b2d6-91f408734b31' class='xr-var-data-in' type='checkbox'><label for='data-ee1b90b9-db7a-4929-b2d6-91f408734b31' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020,
       2021, 2022])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-adf272c1-335f-431c-a4f2-58ac24ccba91' class='xr-section-summary-in' type='checkbox'  checked><label for='section-adf272c1-335f-431c-a4f2-58ac24ccba91' class='xr-section-summary' >Data variables: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>CDD</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>41.91 68.42 53.31 ... 51.69 52.53</div><input id='attrs-9bd919d3-bf38-4662-a2c2-ee3c694acbdb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9bd919d3-bf38-4662-a2c2-ee3c694acbdb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-716b0b1c-e66f-4acf-899d-5fbc41a9a4e1' class='xr-var-data-in' type='checkbox'><label for='data-716b0b1c-e66f-4acf-899d-5fbc41a9a4e1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ 41.91,  68.42,  53.31, ...,  39.54,  85.89,  94.55],
       [ 20.65,  42.89,  33.59, ...,  19.22,  43.83,  53.88],
       [116.4 , 134.89, 116.56, ..., 119.57, 157.07, 171.94],
       ...,
       [ 35.27,  69.31,  57.81, ...,  41.38,  97.23, 106.68],
       [ 14.01,  31.22,  20.88, ...,   7.41,  34.95,  41.79],
       [ 17.69,  34.01,  19.99, ...,   9.41,  51.69,  52.53]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>HDD</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>2.698e+03 3.102e+03 ... 3.226e+03</div><input id='attrs-4300a498-0ef9-42fd-8a4a-1ff534f61c83' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4300a498-0ef9-42fd-8a4a-1ff534f61c83' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ba1aff5e-0587-48df-87ab-3e0102769866' class='xr-var-data-in' type='checkbox'><label for='data-ba1aff5e-0587-48df-87ab-3e0102769866' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[2698.22, 3102.17, 2795.37, ..., 2593.58, 2833.07, 2590.74],
       [3048.54, 3481.74, 3020.3 , ..., 2854.01, 3145.19, 2808.36],
       [2464.46, 2810.38, 2485.41, ..., 2276.6 , 2569.3 , 2254.09],
       ...,
       [2872.84, 3207.01, 2952.35, ..., 2731.92, 3027.36, 2690.52],
       [3412.72, 3701.83, 3419.7 , ..., 3254.27, 3608.45, 3245.37],
       [3304.58, 3596.52, 3395.5 , ..., 3184.9 , 3548.61, 3225.74]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-fc07dca0-f82b-4c1c-9712-73f49510d4e6' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-fc07dca0-f82b-4c1c-9712-73f49510d4e6' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export


* Combining data

The sections below generate the datasets per variable. Once these datasets are generated, the code in this section merges all these variables into one =.csv= file.

** nuts2 data

In this subsection, we merge the data at the NUTS 2 level.

#+begin_src jupyter-python 

from glob import glob
ds_2 = xr.merge([xr.open_dataset(f) for f in glob('./data/*.nc')])
ds_2

#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:                          (age: 100, nuts2: 354, sex: 2, year: 33)
Coordinates:
  * nuts2                            (nuts2) object &#x27;AL01&#x27; &#x27;AL02&#x27; ... &#x27;UKN0&#x27;
  * year                             (year) int64 1990 1991 1992 ... 2021 2022
  * age                              (age) float64 1.0 2.0 3.0 ... 99.0 100.0
  * sex                              (sex) object &#x27;F&#x27; &#x27;M&#x27;
Data variables: (12/15)
    infant mortality                 (nuts2, year) float64 nan nan ... nan nan
    country                          (nuts2, year, sex, age) object nan ... nan
    population                       (nuts2, year, sex, age) float64 nan ... nan
    age_category                     (nuts2, year, sex, age) object nan ... nan
    bad_self_perceived_health        (nuts2, year, sex, age) float64 nan ... nan
    at risk of poverty               (nuts2, year) float64 nan nan ... nan nan
    ...                               ...
    HDD                              (nuts2, year) float64 nan nan ... nan nan
    deaths                           (nuts2, year, sex, age) float64 nan ... nan
    TOOEXP                           (nuts2, year) float64 nan nan ... nan nan
    UNMET                            (nuts2, year) float64 nan nan ... nan nan
    gdp_per_capita                   (nuts2, year) float64 nan nan ... nan nan
    unemployment                     (nuts2, year) float64 nan nan ... nan nan</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-24658f18-7ecf-476e-9d24-ea3e9c03e2d3' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-24658f18-7ecf-476e-9d24-ea3e9c03e2d3' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>age</span>: 100</li><li><span class='xr-has-index'>nuts2</span>: 354</li><li><span class='xr-has-index'>sex</span>: 2</li><li><span class='xr-has-index'>year</span>: 33</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-eefad12c-4862-4e74-97ae-653db44fc4f8' class='xr-section-summary-in' type='checkbox'  checked><label for='section-eefad12c-4862-4e74-97ae-653db44fc4f8' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>nuts2</span></div><div class='xr-var-dims'>(nuts2)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;AL01&#x27; &#x27;AL02&#x27; ... &#x27;UKM9&#x27; &#x27;UKN0&#x27;</div><input id='attrs-cf20f9a7-df11-49e4-bf84-7c1fc1c8b5c1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-cf20f9a7-df11-49e4-bf84-7c1fc1c8b5c1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a772eb33-dd57-47ac-86dc-3bb3d89c5eeb' class='xr-var-data-in' type='checkbox'><label for='data-a772eb33-dd57-47ac-86dc-3bb3d89c5eeb' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AL01&#x27;, &#x27;AL02&#x27;, &#x27;AL03&#x27;, ..., &#x27;UKM8&#x27;, &#x27;UKM9&#x27;, &#x27;UKN0&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1990 1991 1992 ... 2020 2021 2022</div><input id='attrs-88acf852-39be-4146-b7d8-d7c912a8678b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-88acf852-39be-4146-b7d8-d7c912a8678b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-992a5268-4562-4cb0-be5e-98a13e51f24b' class='xr-var-data-in' type='checkbox'><label for='data-992a5268-4562-4cb0-be5e-98a13e51f24b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001,
       2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013,
       2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>age</span></div><div class='xr-var-dims'>(age)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.0 2.0 3.0 4.0 ... 98.0 99.0 100.0</div><input id='attrs-907e6140-3248-417a-91d0-2b29daed23a8' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-907e6140-3248-417a-91d0-2b29daed23a8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-dc824d4d-7050-4068-9a4c-d5f8e5d365ec' class='xr-var-data-in' type='checkbox'><label for='data-dc824d4d-7050-4068-9a4c-d5f8e5d365ec' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([  1.,   2.,   3.,   4.,   5.,   6.,   7.,   8.,   9.,  10.,  11.,  12.,
        13.,  14.,  15.,  16.,  17.,  18.,  19.,  20.,  21.,  22.,  23.,  24.,
        25.,  26.,  27.,  28.,  29.,  30.,  31.,  32.,  33.,  34.,  35.,  36.,
        37.,  38.,  39.,  40.,  41.,  42.,  43.,  44.,  45.,  46.,  47.,  48.,
        49.,  50.,  51.,  52.,  53.,  54.,  55.,  56.,  57.,  58.,  59.,  60.,
        61.,  62.,  63.,  64.,  65.,  66.,  67.,  68.,  69.,  70.,  71.,  72.,
        73.,  74.,  75.,  76.,  77.,  78.,  79.,  80.,  81.,  82.,  83.,  84.,
        85.,  86.,  87.,  88.,  89.,  90.,  91.,  92.,  93.,  94.,  95.,  96.,
        97.,  98.,  99., 100.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>sex</span></div><div class='xr-var-dims'>(sex)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;F&#x27; &#x27;M&#x27;</div><input id='attrs-c783104b-1507-4cbc-aa7f-65621f0c7b3d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c783104b-1507-4cbc-aa7f-65621f0c7b3d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-33943cc5-afcf-4676-910b-4b46d37aa258' class='xr-var-data-in' type='checkbox'><label for='data-33943cc5-afcf-4676-910b-4b46d37aa258' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;F&#x27;, &#x27;M&#x27;], dtype=object)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-17039d25-f935-469a-bc4e-00b4c48ecd7e' class='xr-section-summary-in' type='checkbox'  ><label for='section-17039d25-f935-469a-bc4e-00b4c48ecd7e' class='xr-section-summary' >Data variables: <span>(15)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>infant mortality</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-00282401-7df4-426b-a630-10928384760e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-00282401-7df4-426b-a630-10928384760e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-80764b4e-fd67-4ba0-a24d-98d0511f171f' class='xr-var-data-in' type='checkbox'><label for='data-80764b4e-fd67-4ba0-a24d-98d0511f171f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ nan,  nan,  nan, ...,  9. ,  nan,  nan],
       [ nan,  nan,  nan, ..., 11.3,  nan,  nan],
       [ nan,  nan,  nan, ...,  9.2,  nan,  nan],
       ...,
       [ nan,  nan,  nan, ...,  nan,  nan,  nan],
       [ nan,  nan,  nan, ...,  nan,  nan,  nan],
       [ nan,  nan,  nan, ...,  nan,  nan,  nan]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>country</span></div><div class='xr-var-dims'>(nuts2, year, sex, age)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-2569f54b-0104-43c1-b870-28b779adc188' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2569f54b-0104-43c1-b870-28b779adc188' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-faf0ab82-2881-4bf2-a22c-835c6ac6580a' class='xr-var-data-in' type='checkbox'><label for='data-faf0ab82-2881-4bf2-a22c-835c6ac6580a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        ...,

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]]],

...
         [&#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, ...,
          &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, nan]],

        [[&#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, ...,
          &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, nan],
         [&#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, ...,
          &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, nan]],

        ...,

        [[&#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, ...,
          &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, nan],
         [&#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, ...,
          &#x27;United Kingdom&#x27;, &#x27;United Kingdom&#x27;, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]]]], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>population</span></div><div class='xr-var-dims'>(nuts2, year, sex, age)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-2b5a6a7a-540f-4d27-8069-90a41e4afe80' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2b5a6a7a-540f-4d27-8069-90a41e4afe80' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5109471e-e750-4732-b363-cf1f54c57ef5' class='xr-var-data-in' type='checkbox'><label for='data-5109471e-e750-4732-b363-cf1f54c57ef5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[[   nan,    nan,    nan, ...,    nan,    nan,    nan],
         [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

        [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
         [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

        [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
         [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

        ...,

        [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
         [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

        [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
         [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

        [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
         [   nan,    nan,    nan, ...,    nan,    nan,    nan]]],

...

       [[[   nan,    nan,    nan, ...,    nan,    nan,    nan],
         [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

        [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
         [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

        [[12594., 12486., 12690., ...,    nan,    nan,    nan],
         [13305., 13199., 13380., ...,    nan,    nan,    nan]],

        ...,

        [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
         [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

        [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
         [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

        [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
         [   nan,    nan,    nan, ...,    nan,    nan,    nan]]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>age_category</span></div><div class='xr-var-dims'>(nuts2, year, sex, age)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-3d0629c0-5c27-47e4-96db-90002b1966f6' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3d0629c0-5c27-47e4-96db-90002b1966f6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d80acc0e-ef5c-412f-9bac-05352ab0f0f6' class='xr-var-data-in' type='checkbox'><label for='data-d80acc0e-ef5c-412f-9bac-05352ab0f0f6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        ...,

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]]],

...

       [[[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, nan],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, nan]],

        [[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, nan],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, nan]],

        [[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, nan],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, nan]],

        ...,

        [[&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, nan],
         [&#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, &#x27;Y0-15&#x27;, ..., &#x27;Y_GE85&#x27;, &#x27;Y_GE85&#x27;, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]]]], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>bad_self_perceived_health</span></div><div class='xr-var-dims'>(nuts2, year, sex, age)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-378b98fd-1895-4734-b821-046965bf003e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-378b98fd-1895-4734-b821-046965bf003e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-36480871-8daf-478f-a8c1-439e6398ebc1' class='xr-var-data-in' type='checkbox'><label for='data-36480871-8daf-478f-a8c1-439e6398ebc1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        ...,

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]]],

...

       [[[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        ...,

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>at risk of poverty</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-c4c34113-4a97-4c32-b4dd-890cb40d4c72' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c4c34113-4a97-4c32-b4dd-890cb40d4c72' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d7edc7e8-67a1-4869-8453-39a0c8b69d97' class='xr-var-data-in' type='checkbox'><label for='data-d7edc7e8-67a1-4869-8453-39a0c8b69d97' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ nan,  nan,  nan, ..., 25.1,  nan,  nan],
       [ nan,  nan,  nan, ..., 21.3,  nan,  nan],
       [ nan,  nan,  nan, ..., 19.5,  nan,  nan],
       ...,
       [ nan,  nan,  nan, ...,  nan,  nan,  nan],
       [ nan,  nan,  nan, ...,  nan,  nan,  nan],
       [ nan,  nan,  nan, ...,  nan,  nan,  nan]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>lagged_mortality</span></div><div class='xr-var-dims'>(year, age, nuts2, sex)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-343e6205-e5ee-43de-96a5-b59c4daefbf6' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-343e6205-e5ee-43de-96a5-b59c4daefbf6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b0d1fba8-e81f-4af7-81d8-9e9df48e397c' class='xr-var-data-in' type='checkbox'><label for='data-b0d1fba8-e81f-4af7-81d8-9e9df48e397c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[[nan, nan],
         [nan, nan],
         [nan, nan],
         ...,
         [nan, nan],
         [nan, nan],
         [nan, nan]],

        [[nan, nan],
         [nan, nan],
         [nan, nan],
         ...,
         [nan, nan],
         [nan, nan],
         [nan, nan]],

        [[nan, nan],
         [nan, nan],
         [nan, nan],
         ...,
...
         ...,
         [nan, nan],
         [nan, nan],
         [nan, nan]],

        [[nan, nan],
         [nan, nan],
         [nan, nan],
         ...,
         [nan, nan],
         [nan, nan],
         [nan, nan]],

        [[nan, nan],
         [nan, nan],
         [nan, nan],
         ...,
         [nan, nan],
         [nan, nan],
         [nan, nan]]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>percentage_material_deprivation</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-39587125-4d30-486e-a648-e436009963bf' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-39587125-4d30-486e-a648-e436009963bf' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-60a6478e-8b55-4ee8-aeb8-500d4b11232d' class='xr-var-data-in' type='checkbox'><label for='data-60a6478e-8b55-4ee8-aeb8-500d4b11232d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ nan,  nan,  nan, ..., 36.6,  nan,  nan],
       [ nan,  nan,  nan, ..., 35.1,  nan,  nan],
       [ nan,  nan,  nan, ..., 32.2,  nan,  nan],
       ...,
       [ nan,  nan,  nan, ...,  nan,  nan,  nan],
       [ nan,  nan,  nan, ...,  nan,  nan,  nan],
       [ nan,  nan,  nan, ...,  nan,  nan,  nan]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>CDD</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-f6371535-471a-4171-a8b5-e6b94b7a5a51' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f6371535-471a-4171-a8b5-e6b94b7a5a51' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6e834acb-308c-446c-93d7-be9466378e27' class='xr-var-data-in' type='checkbox'><label for='data-6e834acb-308c-446c-93d7-be9466378e27' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       ...,
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>HDD</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-3a6fa4e5-17a7-42aa-90ce-c9d227695387' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3a6fa4e5-17a7-42aa-90ce-c9d227695387' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f5b4bfdd-7a92-4ffe-b5cd-2693da527f6b' class='xr-var-data-in' type='checkbox'><label for='data-f5b4bfdd-7a92-4ffe-b5cd-2693da527f6b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       ...,
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>deaths</span></div><div class='xr-var-dims'>(nuts2, year, sex, age)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-eb2412b7-8f1f-495c-b77c-8341e1f3503c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-eb2412b7-8f1f-495c-b77c-8341e1f3503c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c60c5463-b2b1-49e8-bbfd-439569674364' class='xr-var-data-in' type='checkbox'><label for='data-c60c5463-b2b1-49e8-bbfd-439569674364' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        ...,

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]]],

...

       [[[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        ...,

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]],

        [[nan, nan, nan, ..., nan, nan, nan],
         [nan, nan, nan, ..., nan, nan, nan]]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>TOOEXP</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-69e466f2-41d9-452d-b497-dc576366bfb9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-69e466f2-41d9-452d-b497-dc576366bfb9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4776612f-c93c-4b0a-a8c4-8f208a1b5eb3' class='xr-var-data-in' type='checkbox'><label for='data-4776612f-c93c-4b0a-a8c4-8f208a1b5eb3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ nan,  nan,  nan, ..., 12. ,  nan,  nan],
       [ nan,  nan,  nan, ...,  7.6,  nan,  nan],
       [ nan,  nan,  nan, ...,  8.5,  nan,  nan],
       ...,
       [ nan,  nan,  nan, ...,  nan,  nan,  nan],
       [ nan,  nan,  nan, ...,  nan,  nan,  nan],
       [ nan,  nan,  nan, ...,  nan,  nan,  nan]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>UNMET</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-69b20fcd-6c70-4228-ab40-df64b2cd722e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-69b20fcd-6c70-4228-ab40-df64b2cd722e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a7d61aeb-dd79-4313-b122-8fdcf1cfe398' class='xr-var-data-in' type='checkbox'><label for='data-a7d61aeb-dd79-4313-b122-8fdcf1cfe398' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ nan,  nan,  nan, ..., 19.8,  nan,  nan],
       [ nan,  nan,  nan, ..., 11.1,  nan,  nan],
       [ nan,  nan,  nan, ..., 13.6,  nan,  nan],
       ...,
       [ nan,  nan,  nan, ...,  nan,  nan,  nan],
       [ nan,  nan,  nan, ...,  nan,  nan,  nan],
       [ nan,  nan,  nan, ...,  nan,  nan,  nan]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>gdp_per_capita</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-841060ae-c4af-4313-baed-b5af15a396bb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-841060ae-c4af-4313-baed-b5af15a396bb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d56da3c1-4ddc-4903-889f-90eee93d3e9f' class='xr-var-data-in' type='checkbox'><label for='data-d56da3c1-4ddc-4903-889f-90eee93d3e9f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[   nan,    nan,    nan, ...,  7400.,    nan,    nan],
       [   nan,    nan,    nan, ..., 11000.,    nan,    nan],
       [   nan,    nan,    nan, ...,  8400.,    nan,    nan],
       ...,
       [   nan,    nan,    nan, ...,    nan,    nan,    nan],
       [   nan,    nan,    nan, ...,    nan,    nan,    nan],
       [   nan,    nan,    nan, ...,    nan,    nan,    nan]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>unemployment</span></div><div class='xr-var-dims'>(nuts2, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... 2.7 nan nan nan</div><input id='attrs-ed8b2c2e-46cb-46fc-a3bd-de5445e9f80f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ed8b2c2e-46cb-46fc-a3bd-de5445e9f80f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6a363c26-f170-475b-89ca-30c7e071b1ef' class='xr-var-data-in' type='checkbox'><label for='data-6a363c26-f170-475b-89ca-30c7e071b1ef' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       ...,
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-6b0caea5-d8e4-42ac-b6aa-2cba8d55cdcf' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-6b0caea5-d8e4-42ac-b6aa-2cba8d55cdcf' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export

#+begin_src jupyter-python :display plain
df = ds_2.to_dataframe()
df.reset_index(inplace=True)
df.rename({'level_0':'age','level_1':'nuts2','level_3':'year'},\
          axis=1,inplace=True)
df['country_code'] = df['nuts2'].str.slice(0,2)
df['nuts1'] = df['nuts2'].str.slice(0,3)
df['country'] = df['country_code'].replace(eurostat_dictionary)
df.head()
#+end_src

#+RESULTS:
#+begin_example
   age nuts2 sex  year  infant mortality  country  population age_category  \
0  1.0  AL01   F  1990               NaN  Albania         NaN          NaN   
1  1.0  AL01   F  1991               NaN  Albania         NaN          NaN   
2  1.0  AL01   F  1992               NaN  Albania         NaN          NaN   
3  1.0  AL01   F  1993               NaN  Albania         NaN          NaN   
4  1.0  AL01   F  1994               NaN  Albania         NaN          NaN   

   bad_self_perceived_health  at risk of poverty  ...  \
0                        NaN                 NaN  ...   
1                        NaN                 NaN  ...   
2                        NaN                 NaN  ...   
3                        NaN                 NaN  ...   
4                        NaN                 NaN  ...   

   percentage_material_deprivation  CDD  HDD  deaths  TOOEXP  UNMET  \
0                              NaN  NaN  NaN     NaN     NaN    NaN   
1                              NaN  NaN  NaN     NaN     NaN    NaN   
2                              NaN  NaN  NaN     NaN     NaN    NaN   
3                              NaN  NaN  NaN     NaN     NaN    NaN   
4                              NaN  NaN  NaN     NaN     NaN    NaN   

   gdp_per_capita  unemployment  country_code nuts1  
0             NaN           NaN            AL   AL0  
1             NaN           NaN            AL   AL0  
2             NaN           NaN            AL   AL0  
3             NaN           NaN            AL   AL0  
4             NaN           NaN            AL   AL0  

[5 rows x 21 columns]
#+end_example

** country data

In this section, we add country level variables to the dataframe.

#+begin_src jupyter-python 

from glob import glob
ds_c = xr.merge([xr.open_dataset(f) for f in glob('./data/country/*.nc')])
ds_c

#+end_src

#+RESULTS:
#+begin_export html
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:                        (country: 33, country_code: 33, sex: 2, year: 29)
Coordinates:
  * country                        (country) object &#x27;Austria&#x27; ... &#x27;United Kin...
  * year                           (year) int64 1992 1993 1994 ... 2019 2020
  * country_code                   (country_code) object &#x27;AT&#x27; &#x27;BA&#x27; ... &#x27;SK&#x27; &#x27;UK&#x27;
  * sex                            (sex) object &#x27;F&#x27; &#x27;M&#x27;
Data variables:
    HF2_PC_CHE                     (country, country_code, year) float64 nan ...
    HF2_PPS_HAB                    (country, country_code, year) float64 nan ...
    HF3_PC_CHE                     (country, country_code, year) float64 nan ...
    HF3_PPS_HAB                    (country, country_code, year) float64 nan ...
    health expenditure per capita  (country, country_code, year) float64 nan ...
    index                          (country, year, sex) float64 nan ... 639.0
    Preventable mortality          (country, year, sex) float64 nan nan ... nan
    Treatable mortality            (country, year, sex) float64 nan nan ... nan</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-8037575c-669e-4b83-a616-45ed97e6ef45' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-8037575c-669e-4b83-a616-45ed97e6ef45' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>country</span>: 33</li><li><span class='xr-has-index'>country_code</span>: 33</li><li><span class='xr-has-index'>sex</span>: 2</li><li><span class='xr-has-index'>year</span>: 29</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-38fa4ee7-60f7-4510-9419-63edb8ac4d04' class='xr-section-summary-in' type='checkbox'  checked><label for='section-38fa4ee7-60f7-4510-9419-63edb8ac4d04' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>country</span></div><div class='xr-var-dims'>(country)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;Austria&#x27; ... &#x27;United Kingdom&#x27;</div><input id='attrs-898d2a0c-49ce-4945-a381-5c6f894075df' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-898d2a0c-49ce-4945-a381-5c6f894075df' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c8567d0a-e363-4990-a98e-473c43df321e' class='xr-var-data-in' type='checkbox'><label for='data-c8567d0a-e363-4990-a98e-473c43df321e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Austria&#x27;, &#x27;Belgium&#x27;, &#x27;Bosnia and Herzegovina&#x27;, &#x27;Bulgaria&#x27;, &#x27;Croatia&#x27;,
       &#x27;Cyprus&#x27;, &#x27;Czechia&#x27;, &#x27;Denmark&#x27;, &#x27;Estonia&#x27;, &#x27;Finland&#x27;, &#x27;France&#x27;,
       &#x27;Germany&#x27;, &#x27;Greece&#x27;, &#x27;Hungary&#x27;, &#x27;Iceland&#x27;, &#x27;Ireland&#x27;, &#x27;Italy&#x27;, &#x27;Latvia&#x27;,
       &#x27;Liechtenstein&#x27;, &#x27;Lithuania&#x27;, &#x27;Luxembourg&#x27;, &#x27;Malta&#x27;, &#x27;Netherlands&#x27;,
       &#x27;Norway&#x27;, &#x27;Poland&#x27;, &#x27;Portugal&#x27;, &#x27;Romania&#x27;, &#x27;Slovakia&#x27;, &#x27;Slovenia&#x27;,
       &#x27;Spain&#x27;, &#x27;Sweden&#x27;, &#x27;Switzerland&#x27;, &#x27;United Kingdom&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>year</span></div><div class='xr-var-dims'>(year)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1992 1993 1994 ... 2018 2019 2020</div><input id='attrs-7091d84d-db60-4fc4-85d0-77a52dabe318' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7091d84d-db60-4fc4-85d0-77a52dabe318' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-19366328-f1c4-4814-913f-70689816b745' class='xr-var-data-in' type='checkbox'><label for='data-19366328-f1c4-4814-913f-70689816b745' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003,
       2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015,
       2016, 2017, 2018, 2019, 2020])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>country_code</span></div><div class='xr-var-dims'>(country_code)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;AT&#x27; &#x27;BA&#x27; &#x27;BE&#x27; ... &#x27;SI&#x27; &#x27;SK&#x27; &#x27;UK&#x27;</div><input id='attrs-1e2777cf-b1b0-4318-afdd-d921ddb35c8e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-1e2777cf-b1b0-4318-afdd-d921ddb35c8e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1e32cbf0-d685-402f-9b0f-dafc13e5a715' class='xr-var-data-in' type='checkbox'><label for='data-1e32cbf0-d685-402f-9b0f-dafc13e5a715' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;AT&#x27;, &#x27;BA&#x27;, &#x27;BE&#x27;, &#x27;BG&#x27;, &#x27;CH&#x27;, &#x27;CY&#x27;, &#x27;CZ&#x27;, &#x27;DE&#x27;, &#x27;DK&#x27;, &#x27;EE&#x27;, &#x27;EL&#x27;, &#x27;ES&#x27;,
       &#x27;FI&#x27;, &#x27;FR&#x27;, &#x27;HR&#x27;, &#x27;HU&#x27;, &#x27;IE&#x27;, &#x27;IS&#x27;, &#x27;IT&#x27;, &#x27;LI&#x27;, &#x27;LT&#x27;, &#x27;LU&#x27;, &#x27;LV&#x27;, &#x27;MT&#x27;,
       &#x27;NL&#x27;, &#x27;NO&#x27;, &#x27;PL&#x27;, &#x27;PT&#x27;, &#x27;RO&#x27;, &#x27;SE&#x27;, &#x27;SI&#x27;, &#x27;SK&#x27;, &#x27;UK&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>sex</span></div><div class='xr-var-dims'>(sex)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;F&#x27; &#x27;M&#x27;</div><input id='attrs-43e8d1b7-5c0c-4f34-834e-0fd6c5bd95f0' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-43e8d1b7-5c0c-4f34-834e-0fd6c5bd95f0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-dc5c2cbd-c98d-4a1c-9053-77d7a4fda4c2' class='xr-var-data-in' type='checkbox'><label for='data-dc5c2cbd-c98d-4a1c-9053-77d7a4fda4c2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;F&#x27;, &#x27;M&#x27;], dtype=object)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-dabe17bf-92f4-4097-85e0-a9b79ef3d95d' class='xr-section-summary-in' type='checkbox'  checked><label for='section-dabe17bf-92f4-4097-85e0-a9b79ef3d95d' class='xr-section-summary' >Data variables: <span>(8)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>HF2_PC_CHE</span></div><div class='xr-var-dims'>(country, country_code, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... 5.62 nan nan</div><input id='attrs-3147d763-3297-44e6-9970-8b1adace5a96' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3147d763-3297-44e6-9970-8b1adace5a96' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a38d64c7-9d3e-4f18-82e7-0f37bff19fcc' class='xr-var-data-in' type='checkbox'><label for='data-a38d64c7-9d3e-4f18-82e7-0f37bff19fcc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[ nan,  nan,  nan, ..., 6.91,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        ...,
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

       [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ..., 4.9 ,  nan,  nan],
        ...,
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

       [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ..., 0.4 ,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        ...,
...
        ...,
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

       [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        ...,
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

       [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        ...,
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ..., 5.62,  nan,  nan]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>HF2_PPS_HAB</span></div><div class='xr-var-dims'>(country, country_code, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... 172.1 nan nan</div><input id='attrs-e0777b6d-11c6-43c7-97e4-cc8f0f6f98cd' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e0777b6d-11c6-43c7-97e4-cc8f0f6f98cd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-441404cf-0d19-45b6-bac2-60a1e07d311c' class='xr-var-data-in' type='checkbox'><label for='data-441404cf-0d19-45b6-bac2-60a1e07d311c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[   nan,    nan,    nan, ..., 274.53,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ..., 187.76,    nan,    nan],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,   3.48,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
...
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ..., 172.06,    nan,    nan]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>HF3_PC_CHE</span></div><div class='xr-var-dims'>(country, country_code, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... 15.88 nan nan</div><input id='attrs-ecf56d0b-5865-4332-8ba9-9522b9cd8a56' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ecf56d0b-5865-4332-8ba9-9522b9cd8a56' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-111b4b99-2f03-478a-bc78-ea52cddd2397' class='xr-var-data-in' type='checkbox'><label for='data-111b4b99-2f03-478a-bc78-ea52cddd2397' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[  nan,   nan,   nan, ..., 18.43,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ..., 17.81,   nan,   nan],
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ..., 29.31,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        ...,
...
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ..., 15.88,   nan,   nan]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>HF3_PPS_HAB</span></div><div class='xr-var-dims'>(country, country_code, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... 486.2 nan nan</div><input id='attrs-5ced0b33-1a8c-49dd-b85f-7fc2408c70ab' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-5ced0b33-1a8c-49dd-b85f-7fc2408c70ab' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f8298881-70a8-422d-b019-c25e71a0930c' class='xr-var-data-in' type='checkbox'><label for='data-f8298881-70a8-422d-b019-c25e71a0930c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[   nan,    nan,    nan, ..., 732.45,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ..., 682.09,    nan,    nan],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ..., 256.89,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
...
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ..., 486.25,    nan,    nan]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>health expenditure per capita</span></div><div class='xr-var-dims'>(country, country_code, year)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan ... 3.839e+03 nan</div><input id='attrs-7b150928-3508-420c-990b-7cb2f0ead429' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7b150928-3508-420c-990b-7cb2f0ead429' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f7026c89-2c05-433d-8e92-3fcc1baa6277' class='xr-var-data-in' type='checkbox'><label for='data-f7026c89-2c05-433d-8e92-3fcc1baa6277' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[    nan,     nan,     nan, ..., 4510.08, 4689.27,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        ...,
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan]],

       [[    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ..., 4343.57, 4438.82,     nan],
        ...,
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan]],

       [[    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,  434.88,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        ...,
...
        ...,
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan]],

       [[    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        ...,
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan]],

       [[    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        ...,
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ...,     nan,     nan,     nan],
        [    nan,     nan,     nan, ..., 3607.59, 3838.53,     nan]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>index</span></div><div class='xr-var-dims'>(country, year, sex)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan ... 637.0 638.0 639.0</div><input id='attrs-eec836dd-01a0-47d7-a2ba-2edf6908b814' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-eec836dd-01a0-47d7-a2ba-2edf6908b814' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b23266e3-ff01-4db0-b4ed-02c39c971c78' class='xr-var-data-in' type='checkbox'><label for='data-b23266e3-ff01-4db0-b4ed-02c39c971c78' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[ nan,  nan],
        [ nan,  nan],
        [ nan,  nan],
        ...,
        [ 14.,  15.],
        [ 16.,  17.],
        [ 18.,  19.]],

       [[ nan,  nan],
        [ nan,  nan],
        [ nan,  nan],
        ...,
        [ 34.,  35.],
        [ 36.,  37.],
        [ 38.,  39.]],

       [[ nan,  nan],
        [ nan,  nan],
        [ nan,  nan],
        ...,
...
        ...,
        [594., 595.],
        [596., 597.],
        [598., 599.]],

       [[ nan,  nan],
        [ nan,  nan],
        [ nan,  nan],
        ...,
        [614., 615.],
        [616., 617.],
        [618., 619.]],

       [[ nan,  nan],
        [ nan,  nan],
        [ nan,  nan],
        ...,
        [634., 635.],
        [636., 637.],
        [638., 639.]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>Preventable mortality</span></div><div class='xr-var-dims'>(country, year, sex)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-f24ea32b-174f-4bc2-99ae-946ac2e092c5' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f24ea32b-174f-4bc2-99ae-946ac2e092c5' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c7f14eba-e0c3-4992-bf4c-a8c90a1d63f1' class='xr-var-data-in' type='checkbox'><label for='data-c7f14eba-e0c3-4992-bf4c-a8c90a1d63f1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[   nan,    nan],
        [   nan,    nan],
        [   nan,    nan],
        ...,
        [ 93.11, 226.09],
        [ 94.79, 213.51],
        [ 99.09, 236.22]],

       [[   nan,    nan],
        [   nan,    nan],
        [   nan,    nan],
        ...,
        [ 92.63, 202.27],
        [ 92.07, 194.96],
        [113.63, 243.79]],

       [[   nan,    nan],
        [   nan,    nan],
        [   nan,    nan],
        ...,
...
        ...,
        [ 84.98, 150.29],
        [ 79.2 , 140.75],
        [ 84.98, 161.62]],

       [[   nan,    nan],
        [   nan,    nan],
        [   nan,    nan],
        ...,
        [ 70.94, 147.78],
        [ 66.9 , 142.11],
        [ 72.59, 161.98]],

       [[   nan,    nan],
        [   nan,    nan],
        [   nan,    nan],
        ...,
        [104.55, 198.42],
        [   nan,    nan],
        [   nan,    nan]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>Treatable mortality</span></div><div class='xr-var-dims'>(country, year, sex)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan nan nan nan ... nan nan nan nan</div><input id='attrs-3b000a2c-1a0a-4039-838b-1ef96bc7aef1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3b000a2c-1a0a-4039-838b-1ef96bc7aef1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-822d41e5-c249-4af7-a70b-e0d5663857d4' class='xr-var-data-in' type='checkbox'><label for='data-822d41e5-c249-4af7-a70b-e0d5663857d4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[  nan,   nan],
        [  nan,   nan],
        [  nan,   nan],
        ...,
        [64.61, 87.16],
        [63.22, 84.21],
        [60.44, 81.55]],

       [[  nan,   nan],
        [  nan,   nan],
        [  nan,   nan],
        ...,
        [66.65, 73.03],
        [61.35, 69.09],
        [59.46, 66.27]],

       [[  nan,   nan],
        [  nan,   nan],
        [  nan,   nan],
        ...,
...
        ...,
        [59.61, 71.77],
        [55.14, 65.35],
        [55.41, 68.87]],

       [[  nan,   nan],
        [  nan,   nan],
        [  nan,   nan],
        ...,
        [47.97, 54.21],
        [47.54, 52.02],
        [44.86, 52.54]],

       [[  nan,   nan],
        [  nan,   nan],
        [  nan,   nan],
        ...,
        [80.19, 95.09],
        [  nan,   nan],
        [  nan,   nan]]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-0e815e1a-bcb1-4e49-936e-4c2d7c8cfad6' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-0e815e1a-bcb1-4e49-936e-4c2d7c8cfad6' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>
#+end_export

#+begin_src jupyter-python :display plain
df_country = ds_c.to_dataframe()
df_country.reset_index(inplace=True)
df_country.rename({'level_0':'country','level_1':'country_code',\
                   'level_3':'year'},axis=1,inplace=True)
df_country.head()
#+end_src

#+RESULTS:
#+begin_example
   country country_code sex  year  HF2_PC_CHE  HF2_PPS_HAB  HF3_PC_CHE  \
0  Austria           AT   F  1992         NaN          NaN         NaN   
1  Austria           AT   F  1993         NaN          NaN         NaN   
2  Austria           AT   F  1994         NaN          NaN         NaN   
3  Austria           AT   F  1995         NaN          NaN         NaN   
4  Austria           AT   F  1996         NaN          NaN         NaN   

   HF3_PPS_HAB  health expenditure per capita  index  Preventable mortality  \
0          NaN                            NaN    NaN                    NaN   
1          NaN                            NaN    NaN                    NaN   
2          NaN                            NaN    NaN                    NaN   
3          NaN                            NaN    NaN                    NaN   
4          NaN                            NaN    NaN                    NaN   

   Treatable mortality  
0                  NaN  
1                  NaN  
2                  NaN  
3                  NaN  
4                  NaN  
#+end_example


#+begin_src jupyter-python :display plain
df = df.merge(df_country, how = 'left',\
              on = ['country','year','country_code','sex'])
# drop rows where deaths > population at Jan. 1st
# (e.g. because people moved in the year)
df = df[(df.population >= df.deaths) & (df.population > 0)]
df['mortality'] = df.deaths/df.population

df.head()
#+end_src

#+RESULTS:
#+begin_example
     age nuts2 sex  year  infant mortality  country  population age_category  \
198  1.0  AT11   F  1990               NaN  Austria      1345.0        Y0-15   
199  1.0  AT11   F  1991               NaN  Austria      1371.0        Y0-15   
200  1.0  AT11   F  1992               NaN  Austria      1436.0        Y0-15   
201  1.0  AT11   F  1993               NaN  Austria      1372.0        Y0-15   
202  1.0  AT11   F  1994               NaN  Austria      1349.0        Y0-15   

     bad_self_perceived_health  at risk of poverty  ...  nuts1  HF2_PC_CHE  \
198                        NaN                 NaN  ...    AT1         NaN   
199                        NaN                 NaN  ...    AT1         NaN   
200                        NaN                 NaN  ...    AT1         NaN   
201                        NaN                 NaN  ...    AT1         NaN   
202                        NaN                 NaN  ...    AT1         NaN   

     HF2_PPS_HAB  HF3_PC_CHE  HF3_PPS_HAB  health expenditure per capita  \
198          NaN         NaN          NaN                            NaN   
199          NaN         NaN          NaN                            NaN   
200          NaN         NaN          NaN                            NaN   
201          NaN         NaN          NaN                            NaN   
202          NaN         NaN          NaN                            NaN   

     index  Preventable mortality  Treatable mortality mortality  
198    NaN                    NaN                  NaN  0.000000  
199    NaN                    NaN                  NaN  0.000000  
200    NaN                    NaN                  NaN  0.000696  
201    NaN                    NaN                  NaN  0.000000  
202    NaN                    NaN                  NaN  0.000741  

[5 rows x 30 columns]
#+end_example

Finally, we save the merged NUTS 2 and country data into a =.csv= file.

#+begin_src jupyter-python 
df.to_csv('./data/data_deaths_by_age_nuts_2.csv')
#+end_src

#+RESULTS:


